/*! For license information please see gridviz-parquet.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.gviz_par=e():t.gviz_par=e()}(self,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};function n(){}function r(t){return null==t?n:function(){return this.querySelector(t)}}function i(){return[]}function o(t){return null==t?i:function(){return this.querySelectorAll(t)}}function a(t){return function(){return this.matches(t)}}function s(t){return function(e){return e.matches(t)}}t.r(e),t.d(e,{ParquetGrid:()=>Mi,TiledParquetGrid:()=>Bi});var u=Array.prototype.find;function f(){return this.firstElementChild}var c=Array.prototype.filter;function l(){return Array.from(this.children)}function h(t){return new Array(t.length)}function p(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function d(t,e,n,r,i,o){for(var a,s=0,u=e.length,f=o.length;s<f;++s)(a=e[s])?(a.__data__=o[s],r[s]=a):n[s]=new p(t,o[s]);for(;s<u;++s)(a=e[s])&&(i[s]=a)}function y(t,e,n,r,i,o,a){var s,u,f,c=new Map,l=e.length,h=o.length,d=new Array(l);for(s=0;s<l;++s)(u=e[s])&&(d[s]=f=a.call(u,u.__data__,s,e)+"",c.has(f)?i[s]=u:c.set(f,u));for(s=0;s<h;++s)f=a.call(t,o[s],s,o)+"",(u=c.get(f))?(r[s]=u,u.__data__=o[s],c.delete(f)):n[s]=new p(t,o[s]);for(s=0;s<l;++s)(u=e[s])&&c.get(d[s])===u&&(i[s]=u)}function m(t){return t.__data__}function v(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function g(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}p.prototype={constructor:p,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var _="http://www.w3.org/1999/xhtml";const w={svg:"http://www.w3.org/2000/svg",xhtml:_,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function b(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),w.hasOwnProperty(e)?{space:w[e],local:t}:t}function x(t){return function(){this.removeAttribute(t)}}function E(t){return function(){this.removeAttributeNS(t.space,t.local)}}function A(t,e){return function(){this.setAttribute(t,e)}}function M(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function T(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function N(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function S(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function I(t){return function(){this.style.removeProperty(t)}}function L(t,e,n){return function(){this.style.setProperty(t,e,n)}}function O(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function P(t,e){return t.style.getPropertyValue(e)||S(t).getComputedStyle(t,null).getPropertyValue(e)}function k(t){return function(){delete this[t]}}function R(t,e){return function(){this[t]=e}}function C(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function D(t){return t.trim().split(/^|\s+/)}function B(t){return t.classList||new z(t)}function z(t){this._node=t,this._names=D(t.getAttribute("class")||"")}function j(t,e){for(var n=B(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function $(t,e){for(var n=B(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function U(t){return function(){j(this,t)}}function Y(t){return function(){$(this,t)}}function F(t,e){return function(){(e.apply(this,arguments)?j:$)(this,t)}}function G(){this.textContent=""}function q(t){return function(){this.textContent=t}}function V(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function X(){this.innerHTML=""}function Z(t){return function(){this.innerHTML=t}}function H(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function W(){this.nextSibling&&this.parentNode.appendChild(this)}function K(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Q(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===_&&e.documentElement.namespaceURI===_?e.createElement(t):e.createElementNS(n,t)}}function J(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function tt(t){var e=b(t);return(e.local?J:Q)(e)}function et(){return null}function nt(){var t=this.parentNode;t&&t.removeChild(this)}function rt(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function it(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ot(t){return function(){var e=this.__on;if(e){for(var n,r=0,i=-1,o=e.length;r<o;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?e.length=i:delete this.__on}}}function at(t,e,n){return function(){var r,i=this.__on,o=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=e);this.addEventListener(t.type,o,n),r={type:t.type,name:t.name,value:e,listener:o,options:n},i?i.push(r):this.__on=[r]}}function st(t,e,n){var r=S(t),i=r.CustomEvent;"function"==typeof i?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ut(t,e){return function(){return st(this,t,e)}}function ft(t,e){return function(){return st(this,t,e.apply(this,arguments))}}z.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var ct=[null];function lt(t,e){this._groups=t,this._parents=e}function ht(){return new lt([[document.documentElement]],ct)}lt.prototype=ht.prototype={constructor:lt,select:function(t){"function"!=typeof t&&(t=r(t));for(var e=this._groups,n=e.length,i=new Array(n),o=0;o<n;++o)for(var a,s,u=e[o],f=u.length,c=i[o]=new Array(f),l=0;l<f;++l)(a=u[l])&&(s=t.call(a,a.__data__,l,u))&&("__data__"in a&&(s.__data__=a.__data__),c[l]=s);return new lt(i,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):o(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var s,u=e[a],f=u.length,c=0;c<f;++c)(s=u[c])&&(r.push(t.call(s,s.__data__,c,u)),i.push(s));return new lt(r,i)},selectChild:function(t){return this.select(null==t?f:function(t){return function(){return u.call(this.children,t)}}("function"==typeof t?t:s(t)))},selectChildren:function(t){return this.selectAll(null==t?l:function(t){return function(){return c.call(this.children,t)}}("function"==typeof t?t:s(t)))},filter:function(t){"function"!=typeof t&&(t=a(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,s=e[i],u=s.length,f=r[i]=[],c=0;c<u;++c)(o=s[c])&&t.call(o,o.__data__,c,s)&&f.push(o);return new lt(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,m);var n,r=e?y:d,i=this._parents,o=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var a=o.length,s=new Array(a),u=new Array(a),f=new Array(a),c=0;c<a;++c){var l=i[c],h=o[c],p=h.length,g=v(t.call(l,l&&l.__data__,c,i)),_=g.length,w=u[c]=new Array(_),b=s[c]=new Array(_);r(l,h,w,b,f[c]=new Array(p),g,e);for(var x,E,A=0,M=0;A<_;++A)if(x=w[A]){for(A>=M&&(M=A+1);!(E=b[M])&&++M<_;);x._next=E||null}}return(s=new lt(s,i))._enter=u,s._exit=f,s},enter:function(){return new lt(this._enter||this._groups.map(h),this._parents)},exit:function(){return new lt(this._exit||this._groups.map(h),this._parents)},join:function(t,e,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(i=e(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,o=r.length,a=Math.min(i,o),s=new Array(i),u=0;u<a;++u)for(var f,c=n[u],l=r[u],h=c.length,p=s[u]=new Array(h),d=0;d<h;++d)(f=c[d]||l[d])&&(p[d]=f);for(;u<i;++u)s[u]=n[u];return new lt(s,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,i=t[e],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=g);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],u=s.length,f=i[o]=new Array(u),c=0;c<u;++c)(a=s[c])&&(f[c]=a);f.sort(e)}return new lt(i,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i,o=e[n],a=0,s=o.length;a<s;++a)(i=o[a])&&t.call(i,i.__data__,a,o);return this},attr:function(t,e){var n=b(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?E:x:"function"==typeof e?n.local?N:T:n.local?M:A)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?I:"function"==typeof e?O:L)(t,e,null==n?"":n)):P(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?k:"function"==typeof e?C:R)(t,e)):this.node()[t]},classed:function(t,e){var n=D(t+"");if(arguments.length<2){for(var r=B(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof e?F:e?U:Y)(n,e))},text:function(t){return arguments.length?this.each(null==t?G:("function"==typeof t?V:q)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?X:("function"==typeof t?H:Z)(t)):this.node().innerHTML},raise:function(){return this.each(W)},lower:function(){return this.each(K)},append:function(t){var e="function"==typeof t?t:tt(t);return this.select((function(){return this.appendChild(e.apply(this,arguments))}))},insert:function(t,e){var n="function"==typeof t?t:tt(t),i=null==e?et:"function"==typeof e?e:r(e);return this.select((function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)}))},remove:function(){return this.each(nt)},clone:function(t){return this.select(t?it:rt)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,i,o=function(t){return t.trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}}))}(t+""),a=o.length;if(!(arguments.length<2)){for(s=e?at:ot,r=0;r<a;++r)this.each(s(o[r],e,n));return this}var s=this.node().__on;if(s)for(var u,f=0,c=s.length;f<c;++f)for(r=0,u=s[f];r<a;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(t,e){return this.each(("function"==typeof e?ft:ut)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,i=t[e],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};const pt=ht;function dt(t){return"string"==typeof t?new lt([[document.querySelector(t)]],[document.documentElement]):new lt([[t]],ct)}var yt={value:()=>{}};function mt(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new vt(r)}function vt(t){this._=t}function gt(t,e){for(var n,r=0,i=t.length;r<i;++r)if((n=t[r]).name===e)return n.value}function _t(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=yt,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}vt.prototype=mt.prototype={constructor:vt,on:function(t,e){var n,r,i=this._,o=(r=i,(t+"").trim().split(/^|\s+/).map((function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}}))),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++a<s;)if(n=(t=o[a]).type)i[n]=_t(i[n],t.name,e);else if(null==e)for(n in i)i[n]=_t(i[n],t.name,null);return this}for(;++a<s;)if((n=(t=o[a]).type)&&(n=gt(i[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new vt(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=0,n=(r=this._[t]).length;o<n;++o)r[o].value.apply(e,i)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,o=r.length;i<o;++i)r[i].value.apply(e,n)}};const wt=mt,bt={capture:!0,passive:!1};function xt(t){t.preventDefault(),t.stopImmediatePropagation()}function Et(t){return((t=Math.exp(t))+1/t)/2}const At=function t(e,n,r){function i(t,i){var o,a,s=t[0],u=t[1],f=t[2],c=i[0],l=i[1],h=i[2],p=c-s,d=l-u,y=p*p+d*d;if(y<1e-12)a=Math.log(h/f)/e,o=function(t){return[s+t*p,u+t*d,f*Math.exp(e*t*a)]};else{var m=Math.sqrt(y),v=(h*h-f*f+r*y)/(2*f*n*m),g=(h*h-f*f-r*y)/(2*h*n*m),_=Math.log(Math.sqrt(v*v+1)-v),w=Math.log(Math.sqrt(g*g+1)-g);a=(w-_)/e,o=function(t){var r,i=t*a,o=Et(_),c=f/(n*m)*(o*(r=e*i+_,((r=Math.exp(2*r))-1)/(r+1))-function(t){return((t=Math.exp(t))-1/t)/2}(_));return[s+c*p,u+c*d,f*o/Et(e*i+_)]}}return o.duration=1e3*a*e/Math.SQRT2,o}return i.rho=function(e){var n=Math.max(.001,+e),r=n*n;return t(n,r,r*r)},i}(Math.SQRT2,2,4);function Mt(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}var Tt,Nt,St=0,It=0,Lt=0,Ot=0,Pt=0,kt=0,Rt="object"==typeof performance&&performance.now?performance:Date,Ct="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Dt(){return Pt||(Ct(Bt),Pt=Rt.now()+kt)}function Bt(){Pt=0}function zt(){this._call=this._time=this._next=null}function jt(t,e,n){var r=new zt;return r.restart(t,e,n),r}function $t(){Pt=(Ot=Rt.now())+kt,St=It=0;try{!function(){Dt(),++St;for(var t,e=Tt;e;)(t=Pt-e._time)>=0&&e._call.call(void 0,t),e=e._next;--St}()}finally{St=0,function(){for(var t,e,n=Tt,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Tt=e);Nt=t,Yt(r)}(),Pt=0}}function Ut(){var t=Rt.now(),e=t-Ot;e>1e3&&(kt-=e,Ot=t)}function Yt(t){St||(It&&(It=clearTimeout(It)),t-Pt>24?(t<1/0&&(It=setTimeout($t,t-Rt.now()-kt)),Lt&&(Lt=clearInterval(Lt))):(Lt||(Ot=Rt.now(),Lt=setInterval(Ut,1e3)),St=1,Ct($t)))}function Ft(t,e,n){var r=new zt;return e=null==e?0:+e,r.restart((n=>{r.stop(),t(n+e)}),e,n),r}zt.prototype=jt.prototype={constructor:zt,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?Dt():+n)+(null==e?0:+e),this._next||Nt===this||(Nt?Nt._next=this:Tt=this,Nt=this),this._call=t,this._time=n,Yt()},stop:function(){this._call&&(this._call=null,this._time=1/0,Yt())}};var Gt=wt("start","end","cancel","interrupt"),qt=[];function Vt(t,e,n,r,i,o){var a=t.__transition;if(a){if(n in a)return}else t.__transition={};!function(t,e,n){var r,i=t.__transition;function o(u){var f,c,l,h;if(1!==n.state)return s();for(f in i)if((h=i[f]).name===n.name){if(3===h.state)return Ft(o);4===h.state?(h.state=6,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete i[f]):+f<e&&(h.state=6,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete i[f])}if(Ft((function(){3===n.state&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(u))})),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(l=n.tween.length),f=0,c=-1;f<l;++f)(h=n.tween[f].value.call(t,t.__data__,n.index,n.group))&&(r[++c]=h);r.length=c+1}}function a(e){for(var i=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(s),n.state=5,1),o=-1,a=r.length;++o<a;)r[o].call(t,i);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),s())}function s(){for(var r in n.state=6,n.timer.stop(),delete i[e],i)return;delete t.__transition}i[e]=n,n.timer=jt((function(t){n.state=1,n.timer.restart(o,n.delay,n.time),n.delay<=t&&o(t-n.delay)}),0,n.time)}(t,n,{name:e,index:r,group:i,on:Gt,tween:qt,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:0})}function Xt(t,e){var n=Ht(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function Zt(t,e){var n=Ht(t,e);if(n.state>3)throw new Error("too late; already running");return n}function Ht(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Wt(t,e){var n,r,i,o=t.__transition,a=!0;if(o){for(i in e=null==e?null:e+"",o)(n=o[i]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete t.__transition}}function Kt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Qt,Jt=180/Math.PI,te={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ee(t,e,n,r,i,o){var a,s,u;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),t*r<e*n&&(t=-t,e=-e,u=-u,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(e,t)*Jt,skewX:Math.atan(u)*Jt,scaleX:a,scaleY:s}}function ne(t,e,n,r){function i(t){return t.length?t.pop()+" ":""}return function(o,a){var s=[],u=[];return o=t(o),a=t(a),function(t,r,i,o,a,s){if(t!==i||r!==o){var u=a.push("translate(",null,e,null,n);s.push({i:u-4,x:Kt(t,i)},{i:u-2,x:Kt(r,o)})}else(i||o)&&a.push("translate("+i+e+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,u),function(t,e,n,o){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:Kt(t,e)})):e&&n.push(i(n)+"rotate("+e+r)}(o.rotate,a.rotate,s,u),function(t,e,n,o){t!==e?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:Kt(t,e)}):e&&n.push(i(n)+"skewX("+e+r)}(o.skewX,a.skewX,s,u),function(t,e,n,r,o,a){if(t!==n||e!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:Kt(t,n)},{i:s-2,x:Kt(e,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,u),o=a=null,function(t){for(var e,n=-1,r=u.length;++n<r;)s[(e=u[n]).i]=e.x(t);return s.join("")}}}var re=ne((function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?te:ee(e.a,e.b,e.c,e.d,e.e,e.f)}),"px, ","px)","deg)"),ie=ne((function(t){return null==t?te:(Qt||(Qt=document.createElementNS("http://www.w3.org/2000/svg","g")),Qt.setAttribute("transform",t),(t=Qt.transform.baseVal.consolidate())?ee((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):te)}),", ",")",")");function oe(t,e){var n,r;return function(){var i=Zt(this,t),o=i.tween;if(o!==n)for(var a=0,s=(r=n=o).length;a<s;++a)if(r[a].name===e){(r=r.slice()).splice(a,1);break}i.tween=r}}function ae(t,e,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Zt(this,t),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:e,value:n},u=0,f=i.length;u<f;++u)if(i[u].name===e){i[u]=s;break}u===f&&i.push(s)}o.tween=i}}function se(t,e,n){var r=t._id;return t.each((function(){var t=Zt(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)})),function(t){return Ht(t,r).value[e]}}function ue(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function fe(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ce(){}var le=.7,he=1/le,pe="\\s*([+-]?\\d+)\\s*",de="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",me=/^#([0-9a-f]{3,8})$/,ve=new RegExp(`^rgb\\(${pe},${pe},${pe}\\)$`),ge=new RegExp(`^rgb\\(${ye},${ye},${ye}\\)$`),_e=new RegExp(`^rgba\\(${pe},${pe},${pe},${de}\\)$`),we=new RegExp(`^rgba\\(${ye},${ye},${ye},${de}\\)$`),be=new RegExp(`^hsl\\(${de},${ye},${ye}\\)$`),xe=new RegExp(`^hsla\\(${de},${ye},${ye},${de}\\)$`),Ee={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Ae(){return this.rgb().formatHex()}function Me(){return this.rgb().formatRgb()}function Te(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=me.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?Ne(e):3===n?new Le(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?Se(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?Se(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=ve.exec(t))?new Le(e[1],e[2],e[3],1):(e=ge.exec(t))?new Le(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=_e.exec(t))?Se(e[1],e[2],e[3],e[4]):(e=we.exec(t))?Se(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=be.exec(t))?De(e[1],e[2]/100,e[3]/100,1):(e=xe.exec(t))?De(e[1],e[2]/100,e[3]/100,e[4]):Ee.hasOwnProperty(t)?Ne(Ee[t]):"transparent"===t?new Le(NaN,NaN,NaN,0):null}function Ne(t){return new Le(t>>16&255,t>>8&255,255&t,1)}function Se(t,e,n,r){return r<=0&&(t=e=n=NaN),new Le(t,e,n,r)}function Ie(t,e,n,r){return 1===arguments.length?((i=t)instanceof ce||(i=Te(i)),i?new Le((i=i.rgb()).r,i.g,i.b,i.opacity):new Le):new Le(t,e,n,null==r?1:r);var i}function Le(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function Oe(){return`#${Ce(this.r)}${Ce(this.g)}${Ce(this.b)}`}function Pe(){const t=ke(this.opacity);return`${1===t?"rgb(":"rgba("}${Re(this.r)}, ${Re(this.g)}, ${Re(this.b)}${1===t?")":`, ${t})`}`}function ke(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Re(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ce(t){return((t=Re(t))<16?"0":"")+t.toString(16)}function De(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ze(t,e,n,r)}function Be(t){if(t instanceof ze)return new ze(t.h,t.s,t.l,t.opacity);if(t instanceof ce||(t=Te(t)),!t)return new ze;if(t instanceof ze)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new ze(a,s,u,t.opacity)}function ze(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function je(t){return(t=(t||0)%360)<0?t+360:t}function $e(t){return Math.max(0,Math.min(1,t||0))}function Ue(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function Ye(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}ue(ce,Te,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ae,formatHex:Ae,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Be(this).formatHsl()},formatRgb:Me,toString:Me}),ue(Le,Ie,fe(ce,{brighter(t){return t=null==t?he:Math.pow(he,t),new Le(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?le:Math.pow(le,t),new Le(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Le(Re(this.r),Re(this.g),Re(this.b),ke(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Oe,formatHex:Oe,formatHex8:function(){return`#${Ce(this.r)}${Ce(this.g)}${Ce(this.b)}${Ce(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Pe,toString:Pe})),ue(ze,(function(t,e,n,r){return 1===arguments.length?Be(t):new ze(t,e,n,null==r?1:r)}),fe(ce,{brighter(t){return t=null==t?he:Math.pow(he,t),new ze(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?le:Math.pow(le,t),new ze(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new Le(Ue(t>=240?t-240:t+120,i,r),Ue(t,i,r),Ue(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ze(je(this.h),$e(this.s),$e(this.l),ke(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ke(this.opacity);return`${1===t?"hsl(":"hsla("}${je(this.h)}, ${100*$e(this.s)}%, ${100*$e(this.l)}%${1===t?")":`, ${t})`}`}}));const Fe=t=>()=>t;function Ge(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):Fe(isNaN(t)?e:t)}const qe=function t(e){var n=function(t){return 1==(t=+t)?Ge:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):Fe(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=Ie(t)).r,(e=Ie(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=Ge(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function Ve(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=Ie(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}Ve((function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return Ye((n-r/e)*e,a,i,o,s)}})),Ve((function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return Ye((n-r/e)*e,i,o,a,s)}}));var Xe=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ze=new RegExp(Xe.source,"g");function He(t,e){var n,r,i,o=Xe.lastIndex=Ze.lastIndex=0,a=-1,s=[],u=[];for(t+="",e+="";(n=Xe.exec(t))&&(r=Ze.exec(e));)(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Kt(n,r)})),o=Ze.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(t){return function(e){return t(e)+""}}(u[0].x):function(t){return function(){return t}}(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function We(t,e){var n;return("number"==typeof e?Kt:e instanceof Te?qe:(n=Te(e))?(e=n,qe):He)(t,e)}function Ke(t){return function(){this.removeAttribute(t)}}function Qe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Je(t,e,n){var r,i,o=n+"";return function(){var a=this.getAttribute(t);return a===o?null:a===r?i:i=e(r=a,n)}}function tn(t,e,n){var r,i,o=n+"";return function(){var a=this.getAttributeNS(t.space,t.local);return a===o?null:a===r?i:i=e(r=a,n)}}function en(t,e,n){var r,i,o;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttribute(t))===(s=u+"")?null:a===r&&s===i?o:(i=s,o=e(r=a,u));this.removeAttribute(t)}}function nn(t,e,n){var r,i,o;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttributeNS(t.space,t.local))===(s=u+"")?null:a===r&&s===i?o:(i=s,o=e(r=a,u));this.removeAttributeNS(t.space,t.local)}}function rn(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,i)),n}return i._value=e,i}function on(t,e){var n,r;function i(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,i)),n}return i._value=e,i}function an(t,e){return function(){Xt(this,t).delay=+e.apply(this,arguments)}}function sn(t,e){return e=+e,function(){Xt(this,t).delay=e}}function un(t,e){return function(){Zt(this,t).duration=+e.apply(this,arguments)}}function fn(t,e){return e=+e,function(){Zt(this,t).duration=e}}var cn=pt.prototype.constructor;function ln(t){return function(){this.style.removeProperty(t)}}var hn=0;function pn(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function dn(){return++hn}var yn=pt.prototype;pn.prototype=function(t){return pt().transition(t)}.prototype={constructor:pn,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=r(t));for(var i=this._groups,o=i.length,a=new Array(o),s=0;s<o;++s)for(var u,f,c=i[s],l=c.length,h=a[s]=new Array(l),p=0;p<l;++p)(u=c[p])&&(f=t.call(u,u.__data__,p,c))&&("__data__"in u&&(f.__data__=u.__data__),h[p]=f,Vt(h[p],e,n,p,h,Ht(u,n)));return new pn(a,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=o(t));for(var r=this._groups,i=r.length,a=[],s=[],u=0;u<i;++u)for(var f,c=r[u],l=c.length,h=0;h<l;++h)if(f=c[h]){for(var p,d=t.call(f,f.__data__,h,c),y=Ht(f,n),m=0,v=d.length;m<v;++m)(p=d[m])&&Vt(p,e,n,m,d,y);a.push(d),s.push(f)}return new pn(a,s,e,n)},selectChild:yn.selectChild,selectChildren:yn.selectChildren,filter:function(t){"function"!=typeof t&&(t=a(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var o,s=e[i],u=s.length,f=r[i]=[],c=0;c<u;++c)(o=s[c])&&t.call(o,o.__data__,c,s)&&f.push(o);return new pn(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var u,f=e[s],c=n[s],l=f.length,h=a[s]=new Array(l),p=0;p<l;++p)(u=f[p]||c[p])&&(h[p]=u);for(;s<r;++s)a[s]=e[s];return new pn(a,this._parents,this._name,this._id)},selection:function(){return new cn(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=dn(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s.length,f=0;f<u;++f)if(a=s[f]){var c=Ht(a,e);Vt(a,t,n,f,s,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new pn(r,this._parents,t,n)},call:yn.call,nodes:yn.nodes,node:yn.node,size:yn.size,empty:yn.empty,each:yn.each,on:function(t,e){var n=this._id;return arguments.length<2?Ht(this.node(),n).on.on(t):this.each(function(t,e,n){var r,i,o=function(t){return(t+"").trim().split(/^|\s+/).every((function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t}))}(e)?Xt:Zt;return function(){var a=o(this,t),s=a.on;s!==r&&(i=(r=s).copy()).on(e,n),a.on=i}}(n,t,e))},attr:function(t,e){var n=b(t),r="transform"===n?ie:We;return this.attrTween(t,"function"==typeof e?(n.local?nn:en)(n,r,se(this,"attr."+t,e)):null==e?(n.local?Qe:Ke)(n):(n.local?tn:Je)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=b(t);return this.tween(n,(r.local?rn:on)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?re:We;return null==e?this.styleTween(t,function(t,e){var n,r,i;return function(){var o=P(this,t),a=(this.style.removeProperty(t),P(this,t));return o===a?null:o===n&&a===r?i:i=e(n=o,r=a)}}(t,r)).on("end.style."+t,ln(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,i,o;return function(){var a=P(this,t),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(t),u=s=P(this,t)),a===u?null:a===r&&u===i?o:(i=u,o=e(r=a,s))}}(t,r,se(this,"style."+t,e))).each(function(t,e){var n,r,i,o,a="style."+e,s="end."+a;return function(){var u=Zt(this,t),f=u.on,c=null==u.value[a]?o||(o=ln(e)):void 0;f===n&&i===c||(r=(n=f).copy()).on(s,i=c),u.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,i,o=n+"";return function(){var a=P(this,t);return a===o?null:a===r?i:i=e(r=a,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,i;function o(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,o,n)),r}return o._value=e,o}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(se(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,i=Ht(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===t)return r.value;return null}return this.each((null==e?oe:ae)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?an:sn)(e,t)):Ht(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?un:fn)(e,t)):Ht(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){Zt(this,t).ease=e}}(e,t)):Ht(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;Zt(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,i=n.size();return new Promise((function(o,a){var s={value:a},u={value:function(){0==--i&&o()}};n.each((function(){var n=Zt(this,r),i=n.on;i!==t&&((e=(t=i).copy())._.cancel.push(s),e._.interrupt.push(s),e._.end.push(u)),n.on=e})),0===i&&o()}))},[Symbol.iterator]:yn[Symbol.iterator]};var mn={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function vn(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}pt.prototype.interrupt=function(t){return this.each((function(){Wt(this,t)}))},pt.prototype.transition=function(t){var e,n;t instanceof pn?(e=t._id,t=t._name):(e=dn(),(n=mn).time=Dt(),t=null==t?null:t+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s.length,f=0;f<u;++f)(a=s[f])&&Vt(a,t,e,f,s,n||vn(a,e));return new pn(r,this._parents,t,e)};const gn=t=>()=>t;function _n(t,{sourceEvent:e,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function wn(t,e,n){this.k=t,this.x=e,this.y=n}wn.prototype={constructor:wn,scale:function(t){return 1===t?this:new wn(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new wn(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var bn=new wn(1,0,0);function xn(t){t.stopImmediatePropagation()}function En(t){t.preventDefault(),t.stopImmediatePropagation()}function An(t){return!(t.ctrlKey&&"wheel"!==t.type||t.button)}function Mn(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function Tn(){return this.__zoom||bn}function Nn(t){return-t.deltaY*(1===t.deltaMode?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Sn(){return navigator.maxTouchPoints||"ontouchstart"in this}function In(t,e,n){var r=t.invertX(e[0][0])-n[0][0],i=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],a=t.invertY(e[1][1])-n[1][1];return t.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}wn.prototype;class Ln{constructor(t,e=0,n=0,r=0,i=void 0){this.opts=i||{},this.canvas=t,this.canvas.style.cursor="grab",this.w=this.canvas.offsetWidth,this.h=this.canvas.offsetHeight,this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.w,this.offscreenCanvas.height=this.h;const o=this.canvas.getContext("2d"),a=this.offscreenCanvas.getContext("2d");if(!o)throw"Impossible to create canvas 2D context";if(!a)throw"Impossible to create canvas 2D context";if(this.ctx=o,this.offscreenCtx=a,this.view={x:e,y:n,z:r},this.backgroundColor=i.backgroundColor||"white",this.onZoomStartFun=i.onZoomStartFun,this.onZoomEndFun=i.onZoomEndFun,this.onZoomFun=i.onZoomFun,this.extGeo={xMin:NaN,xMax:NaN,yMin:NaN,yMax:NaN},this.updateExtentGeo(),!i.disableZoom){let t=bn;(function(){var t,e,n,r=An,i=Mn,o=In,a=Nn,s=Sn,u=[0,1/0],f=[[-1/0,-1/0],[1/0,1/0]],c=250,l=At,h=wt("start","zoom","end"),p=0,d=10;function y(t){t.property("__zoom",Tn).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",E).on("dblclick.zoom",A).filter(s).on("touchstart.zoom",M).on("touchmove.zoom",T).on("touchend.zoom touchcancel.zoom",N).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(t,e){return(e=Math.max(u[0],Math.min(u[1],e)))===t.k?t:new wn(e,t.x,t.y)}function v(t,e,n){var r=e[0]-n[0]*t.k,i=e[1]-n[1]*t.k;return r===t.x&&i===t.y?t:new wn(t.k,r,i)}function g(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function _(t,e,n,r){t.on("start.zoom",(function(){w(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){w(this,arguments).event(r).end()})).tween("zoom",(function(){var t=this,o=arguments,a=w(t,o).event(r),s=i.apply(t,o),u=null==n?g(s):"function"==typeof n?n.apply(t,o):n,f=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),c=t.__zoom,h="function"==typeof e?e.apply(t,o):e,p=l(c.invert(u).concat(f/c.k),h.invert(u).concat(f/h.k));return function(t){if(1===t)t=h;else{var e=p(t),n=f/e[2];t=new wn(n,u[0]-e[0]*n,u[1]-e[1]*n)}a.zoom(null,t)}}))}function w(t,e,n){return!n&&t.__zooming||new b(t,e)}function b(t,e){this.that=t,this.args=e,this.active=0,this.sourceEvent=null,this.extent=i.apply(t,e),this.taps=0}function x(t,...e){if(r.apply(this,arguments)){var n=w(this,e).event(t),i=this.__zoom,s=Math.max(u[0],Math.min(u[1],i.k*Math.pow(2,a.apply(this,arguments)))),c=Mt(t);if(n.wheel)n.mouse[0][0]===c[0]&&n.mouse[0][1]===c[1]||(n.mouse[1]=i.invert(n.mouse[0]=c)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[c,i.invert(c)],Wt(this),n.start()}En(t),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),150),n.zoom("mouse",o(v(m(i,s),n.mouse[0],n.mouse[1]),n.extent,f))}}function E(t,...e){if(!n&&r.apply(this,arguments)){var i=t.currentTarget,a=w(this,e,!0).event(t),s=dt(t.view).on("mousemove.zoom",(function(t){if(En(t),!a.moved){var e=t.clientX-c,n=t.clientY-l;a.moved=e*e+n*n>p}a.event(t).zoom("mouse",o(v(a.that.__zoom,a.mouse[0]=Mt(t,i),a.mouse[1]),a.extent,f))}),!0).on("mouseup.zoom",(function(t){s.on("mousemove.zoom mouseup.zoom",null),function(t,e){var n=t.document.documentElement,r=dt(t).on("dragstart.drag",null);e&&(r.on("click.drag",xt,bt),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(t.view,a.moved),En(t),a.event(t).end()}),!0),u=Mt(t,i),c=t.clientX,l=t.clientY;!function(t){var e=t.document.documentElement,n=dt(t).on("dragstart.drag",xt,bt);"onselectstart"in e?n.on("selectstart.drag",xt,bt):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(t.view),xn(t),a.mouse=[u,this.__zoom.invert(u)],Wt(this),a.start()}}function A(t,...e){if(r.apply(this,arguments)){var n=this.__zoom,a=Mt(t.changedTouches?t.changedTouches[0]:t,this),s=n.invert(a),u=n.k*(t.shiftKey?.5:2),l=o(v(m(n,u),a,s),i.apply(this,e),f);En(t),c>0?dt(this).transition().duration(c).call(_,l,a,t):dt(this).call(y.transform,l,a,t)}}function M(n,...i){if(r.apply(this,arguments)){var o,a,s,u,f=n.touches,c=f.length,l=w(this,i,n.changedTouches.length===c).event(n);for(xn(n),a=0;a<c;++a)u=[u=Mt(s=f[a],this),this.__zoom.invert(u),s.identifier],l.touch0?l.touch1||l.touch0[2]===u[2]||(l.touch1=u,l.taps=0):(l.touch0=u,o=!0,l.taps=1+!!t);t&&(t=clearTimeout(t)),o&&(l.taps<2&&(e=u[0],t=setTimeout((function(){t=null}),500)),Wt(this),l.start())}}function T(t,...e){if(this.__zooming){var n,r,i,a,s=w(this,e).event(t),u=t.changedTouches,c=u.length;for(En(t),n=0;n<c;++n)i=Mt(r=u[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var l=s.touch0[0],h=s.touch0[1],p=s.touch1[0],d=s.touch1[1],y=(y=p[0]-l[0])*y+(y=p[1]-l[1])*y,g=(g=d[0]-h[0])*g+(g=d[1]-h[1])*g;r=m(r,Math.sqrt(y/g)),i=[(l[0]+p[0])/2,(l[1]+p[1])/2],a=[(h[0]+d[0])/2,(h[1]+d[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(v(r,i,a),s.extent,f))}}function N(t,...r){if(this.__zooming){var i,o,a=w(this,r).event(t),s=t.changedTouches,u=s.length;for(xn(t),n&&clearTimeout(n),n=setTimeout((function(){n=null}),500),i=0;i<u;++i)o=s[i],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=Mt(o,this),Math.hypot(e[0]-o[0],e[1]-o[1])<d)){var f=dt(this).on("dblclick.zoom");f&&f.apply(this,arguments)}}}return y.transform=function(t,e,n,r){var i=t.selection?t.selection():t;i.property("__zoom",Tn),t!==i?_(t,e,n,r):i.interrupt().each((function(){w(this,arguments).event(r).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},y.scaleBy=function(t,e,n,r){y.scaleTo(t,(function(){return this.__zoom.k*("function"==typeof e?e.apply(this,arguments):e)}),n,r)},y.scaleTo=function(t,e,n,r){y.transform(t,(function(){var t=i.apply(this,arguments),r=this.__zoom,a=null==n?g(t):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),u="function"==typeof e?e.apply(this,arguments):e;return o(v(m(r,u),a,s),t,f)}),n,r)},y.translateBy=function(t,e,n,r){y.transform(t,(function(){return o(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),f)}),null,r)},y.translateTo=function(t,e,n,r,a){y.transform(t,(function(){var t=i.apply(this,arguments),a=this.__zoom,s=null==r?g(t):"function"==typeof r?r.apply(this,arguments):r;return o(bn.translate(s[0],s[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof n?-n.apply(this,arguments):-n),t,f)}),r,a)},b.prototype={event:function(t){return t&&(this.sourceEvent=t),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){var e=dt(this.that).datum();h.call(t,this.that,new _n(t,{sourceEvent:this.sourceEvent,target:y,type:t,transform:this.that.__zoom,dispatch:h}),e)}},y.wheelDelta=function(t){return arguments.length?(a="function"==typeof t?t:gn(+t),y):a},y.filter=function(t){return arguments.length?(r="function"==typeof t?t:gn(!!t),y):r},y.touchable=function(t){return arguments.length?(s="function"==typeof t?t:gn(!!t),y):s},y.extent=function(t){return arguments.length?(i="function"==typeof t?t:gn([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),y):i},y.scaleExtent=function(t){return arguments.length?(u[0]=+t[0],u[1]=+t[1],y):[u[0],u[1]]},y.translateExtent=function(t){return arguments.length?(f[0][0]=+t[0][0],f[1][0]=+t[1][0],f[0][1]=+t[0][1],f[1][1]=+t[1][1],y):[[f[0][0],f[0][1]],[f[1][0],f[1][1]]]},y.constrain=function(t){return arguments.length?(o=t,y):o},y.duration=function(t){return arguments.length?(c=+t,y):c},y.interpolate=function(t){return arguments.length?(l=t,y):l},y.on=function(){var t=h.on.apply(h,arguments);return t===h?y:t},y.clickDistance=function(t){return arguments.length?(p=(t=+t)*t,y):Math.sqrt(p)},y.tapDistance=function(t){return arguments.length?(d=+t,y):d},y})().wheelDelta((t=>-t.deltaY*(1===t.deltaMode?.07:t.deltaMode?1:.004))).on("zoom",(n=>{this._isZooming=!0;const r=n.transform,i=t.k/r.k;if(1==i){const e=t.x-r.x,n=t.y-r.y;this.applyPan(e*this.view.z,-n*this.view.z)}else e(n,i);t=r,this.onZoomFun&&this.onZoomFun(n)})).on("start",(t=>{try{this.canvas.style.cursor="grabbing"}catch(t){}this._isZooming=!0,this.canvasSave.c=document.createElement("canvas"),this.canvasSave.c.setAttribute("width",""+this.w),this.canvasSave.c.setAttribute("height",""+this.h),this.canvasSave.c.getContext("2d")?.drawImage(this.canvas,0,0),this.canvasSave.dx=0,this.canvasSave.dy=0,this.canvasSave.f=1,this.onZoomStartFun&&this.onZoomStartFun(t)})).on("end",(t=>{try{this.canvas.style.cursor="grab"}catch(t){}this._isZooming=!1,this.redraw(),this.canvasSave={c:null,dx:0,dy:0,f:1},this.onZoomEndFun&&this.onZoomEndFun(t)}))(dt(this.canvas));const e=(t,e)=>{this.cancelCurrentRequests();const n=t.sourceEvent;if(n instanceof WheelEvent)this.applyZoom(e,this.pixToGeoX(n.offsetX),this.pixToGeoY(n.offsetY));else if(n instanceof TouchEvent){let t=0,r=0;for(let e of n.targetTouches)t+=e.clientX,r+=e.clientY;t/=n.targetTouches.length,r/=n.targetTouches.length,this.applyZoom(e,this.pixToGeoX(t),this.pixToGeoY(r))}}}this.xMin=i.centerExtent?i.centerExtent[0]:void 0,this.yMin=i.centerExtent?i.centerExtent[1]:void 0,this.xMax=i.centerExtent?i.centerExtent[2]:void 0,this.yMax=i.centerExtent?i.centerExtent[3]:void 0,this.zoomExtent=i.zoomExtent||[0,1/0],this.canvasSave={c:null,dx:0,dy:0,f:1}}applyPan(t=0,e=0){if(null!=this.xMin&&this.view.x+t<this.xMin&&(t=this.xMin-this.view.x),null!=this.yMin&&this.view.y+e<this.yMin&&(e=this.yMin-this.view.y),null!=this.xMax&&this.view.x+t>this.xMax&&(t=this.xMax-this.view.x),null!=this.yMax&&this.view.y+e>this.yMax&&(e=this.yMax-this.view.y),this.view.x+=t,this.view.y+=e,this.updateExtentGeo(),this.canvasSave.c){const n=1/this.view.z;this.canvasSave.dx-=t*n,this.canvasSave.dy+=e*n,this.clear(this.backgroundColor),this.offscreenCtx.drawImage(this.canvasSave.c,this.canvasSave.dx,this.canvasSave.dy),this.ctx.drawImage(this.offscreenCtx.canvas,0,0)}else console.log("no canvas save")}applyZoom(t=1,e=this.view.x,n=this.view.y){if(this.zoomExtent[0]==this.view.z&&t<=1)return;if(this.zoomExtent[1]==this.view.z&&t>=1)return;const r=t*this.view.z;r<this.zoomExtent[0]&&(t=this.zoomExtent[0]/this.view.z),r>this.zoomExtent[1]&&(t=this.zoomExtent[1]/this.view.z),this.view.z*=t;let i=(e-this.view.x)*(1-t),o=(n-this.view.y)*(1-t);null!=this.xMin&&this.view.x+i<this.xMin&&(i=this.xMin-this.view.x),null!=this.yMin&&this.view.y+o<this.yMin&&(o=this.yMin-this.view.y),null!=this.xMax&&this.view.x+i>this.xMax&&(i=this.xMax-this.view.x),null!=this.yMax&&this.view.y+o>this.yMax&&(o=this.yMax-this.view.y),this.view.x+=i,this.view.y+=o,this.updateExtentGeo(),this._drawZoomFrame(t,e,n)}_drawZoomFrame(t,e,n){this.canvasSave.c&&(this.clear(this.backgroundColor),this.canvasSave.f/=t,this.canvasSave.dx=this.geoToPixX(e)*(1-this.canvasSave.f),this.canvasSave.dy=this.geoToPixY(n)*(1-this.canvasSave.f),this.clear(this.backgroundColor),this.offscreenCtx.drawImage(this.canvasSave.c,this.canvasSave.dx,this.canvasSave.dy,this.canvasSave.f*this.canvasSave.c.width,this.canvasSave.f*this.canvasSave.c.height),this.ctx.drawImage(this.offscreenCanvas,0,0,this.canvas.width,this.canvas.height))}clear(t="white"){this.opts.transparentBackground?(this.ctx.clearRect(0,0,this.w,this.h),this.offscreenCtx.clearRect(0,0,this.w,this.h)):(this.ctx&&(this.ctx.fillStyle=t),this.offscreenCtx&&(this.offscreenCtx.fillStyle=t),this.ctx.fillRect(0,0,this.w,this.h),this.offscreenCtx.fillRect(0,0,this.w,this.h))}getView(){return this.view}setCenterExtent(t){this.xMin=t[0],this.yMin=t[1],this.xMax=t[2],this.yMax=t[3]}getCenterExtent(){return[this.xMin,this.yMin,this.xMax,this.yMax]}setZoomExtent(t){this.zoomExtent=t}getZoomExtent(){return this.zoomExtent}initCanvasTransform(){this.ctx.setTransform(1,0,0,1,0,0),this.offscreenCtx.setTransform(1,0,0,1,0,0)}setCanvasTransform(){const t=1/this.view.z,e=-this.view.x/this.view.z+.5*this.w,n=this.view.y/this.view.z+.5*this.h;this.ctx.setTransform(t,0,0,-t,e,n),this.offscreenCtx.setTransform(t,0,0,-t,e,n)}getWebGLTransform(){const t=2/(this.w*this.view.z),e=2/(this.h*this.view.z);return[t,0,0,0,e,0,-t*this.view.x,-e*this.view.y,1]}redraw(){throw new Error("Method redraw not implemented.")}cancelCurrentRequests(){throw new Error("Method cancelCurrentRequests not implemented.")}updateExtentGeo(t=20){return this.extGeo={xMin:this.pixToGeoX(-t),xMax:this.pixToGeoX(this.w+t),yMin:this.pixToGeoY(this.h+t),yMax:this.pixToGeoY(-t)},this.extGeo}toDraw(t){return!(t.x<this.extGeo.xMin||t.x>this.extGeo.xMax||t.y<this.extGeo.yMin||t.y>this.extGeo.yMax)}geoToPixX(t){return(t-this.view.x)/this.view.z+.5*this.w}geoToPixY(t){return-(t-this.view.y)/this.view.z+.5*this.h}pixToGeoX(t){return(t-.5*this.w)*this.view.z+this.view.x}pixToGeoY(t){return-(t-.5*this.h)*this.view.z+this.view.y}setViewFromURL(){const t=Ln.getParameterByName("x"),e=Ln.getParameterByName("y"),n=Ln.getParameterByName("z");null==t||null==t||isNaN(+t)||(this.view.x=+t),null==e||null==e||isNaN(+e)||(this.view.y=+e),null==n||null==n||isNaN(+n)||(this.view.z=+n)}static getParameterByName(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return e?decodeURIComponent(e[1].replace(/\+/g," ")):null}}class On{constructor(t,e,n,r={}){this.map=t,this.url=e,this.resolution=n,this.mixedResolution=r.mixedResolution,this.preprocess=r.preprocess||void 0,this.cellsViewCache=[]}getData(t=void 0){throw new Error("Method getData not implemented.")}updateViewCache(t){throw new Error("Method updateViewCache not implemented.")}getCellFromPosition(t,e){if(this.mixedResolution){for(const n of e){const e=+this.mixedResolution(n);if(!(t.x<n.x||n.x+e<t.x||t.y<n.y||n.y+e<t.y))return n}return}const n=this.getResolution();for(const r of e)if(!(t.x<r.x||r.x+n<t.x||t.y<r.y||r.y+n<t.y))return r}getResolution(){return this.resolution}getViewCache(){return this.cellsViewCache}getDataset(t,e){return this}}function Pn(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);if(204!==t.status&&205!==t.status)return t.json()}function kn(t,e){return fetch(t,e).then(Pn)}var Rn={},Cn={};function Dn(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Bn(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function zn(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function jn(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,f=!1;function c(){if(u)return Cn;if(f)return f=!1,Rn;var e,r,i=a;if(34===t.charCodeAt(i)){for(;a++<o&&34!==t.charCodeAt(a)||34===t.charCodeAt(++a););return(e=a)>=o?u=!0:10===(r=t.charCodeAt(a++))?f=!0:13===r&&(f=!0,10===t.charCodeAt(a)&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=t.charCodeAt(e=a++)))f=!0;else if(13===r)f=!0,10===t.charCodeAt(a)&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}for(10===t.charCodeAt(o-1)&&--o,13===t.charCodeAt(o-1)&&--o;(r=c())!==Cn;){for(var l=[];r!==Rn&&r!==Cn;)l.push(r),r=c();e&&null==(l=e(l,s++))||i.push(l)}return i}function i(e,n){return e.map((function(e){return n.map((function(t){return a(e[t])})).join(t)}))}function o(e){return e.map(a).join(t)}function a(t){return null==t?"":t instanceof Date?(i=(n=t).getUTCHours(),o=n.getUTCMinutes(),a=n.getUTCSeconds(),s=n.getUTCMilliseconds(),isNaN(n)?"Invalid Date":((r=n.getUTCFullYear())<0?"-"+zn(-r,6):r>9999?"+"+zn(r,6):zn(r,4))+"-"+zn(n.getUTCMonth()+1,2)+"-"+zn(n.getUTCDate(),2)+(s?"T"+zn(i,2)+":"+zn(o,2)+":"+zn(a,2)+"."+zn(s,3)+"Z":a?"T"+zn(i,2)+":"+zn(o,2)+":"+zn(a,2)+"Z":o||i?"T"+zn(i,2)+":"+zn(o,2)+"Z":"")):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t;var n,r,i,o,a,s}return{parse:function(t,e){var n,i,o=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?function(t,e){var n=Dn(t);return function(r,i){return e(n(r),i,t)}}(t,e):Dn(t)}));return o.columns=i||[],o},parseRows:r,format:function(e,n){return null==n&&(n=Bn(e)),[n.map(a).join(t)].concat(i(e,n)).join("\n")},formatBody:function(t,e){return null==e&&(e=Bn(t)),i(t,e).join("\n")},formatRows:function(t){return t.map(o).join("\n")},formatRow:o,formatValue:a}}var $n=jn(","),Un=$n.parse,Yn=($n.parseRows,$n.format,$n.formatBody,$n.formatRows,$n.formatRow,$n.formatValue,jn("\t")),Fn=Yn.parse;function Gn(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}function qn(t){return function(e,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=void 0),function(t,e){return fetch(t,e).then(Gn)}(e,n).then((function(e){return t(e,r)}))}}Yn.parseRows,Yn.format,Yn.formatBody,Yn.formatRows,Yn.formatRow,Yn.formatValue,qn(Un),qn(Fn),function t(e){function n(t,n){var r,i;return t=null==t?0:+t,n=null==n?1:+n,function(){var o;if(null!=r)o=r,r=null;else do{r=2*e()-1,o=2*e()-1,i=r*r+o*o}while(!i||i>1);return t+n*o*Math.sqrt(-2*Math.log(i)/i)}}return n.source=t,n}(Math.random);const Vn=t=>t;function Xn(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}Vn.invert=Vn;var Zn,Hn=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Wn(t){if(!(e=Hn.exec(t)))throw new Error("invalid format: "+t);var e;return new Kn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Kn(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function Qn(t,e){var n=Xn(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Wn.prototype=Kn.prototype,Kn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Jn={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Qn(100*t,e),r:Qn,s:function(t,e){var n=Xn(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(Zn=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Xn(t,Math.max(0,e+o-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function tr(t){return t}var er,nr=Array.prototype.map,rr=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ir(t){return er=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?tr:(e=nr.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var i=t.length,o=[],a=0,s=e[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(t.substring(i-=s,i+s)),!((u+=s+1)>r));)s=e[a=(a+1)%e.length];return o.reverse().join(n)}),i=void 0===t.currency?"":t.currency[0]+"",o=void 0===t.currency?"":t.currency[1]+"",a=void 0===t.decimal?".":t.decimal+"",s=void 0===t.numerals?tr:function(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}(nr.call(t.numerals,String)),u=void 0===t.percent?"%":t.percent+"",f=void 0===t.minus?"":t.minus+"",c=void 0===t.nan?"NaN":t.nan+"";function l(t){var e=(t=Wn(t)).fill,n=t.align,l=t.sign,h=t.symbol,p=t.zero,d=t.width,y=t.comma,m=t.precision,v=t.trim,g=t.type;"n"===g?(y=!0,g="g"):Jn[g]||(void 0===m&&(m=12),v=!0,g="g"),(p||"0"===e&&"="===n)&&(p=!0,e="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",w="$"===h?o:/[%p]/.test(g)?u:"",b=Jn[g],x=/[defgprs%]/.test(g);function E(t){var i,o,u,h=_,E=w;if("c"===g)E=b(t)+E,t="";else{var A=(t=+t)<0||1/t<0;if(t=isNaN(t)?c:b(Math.abs(t),m),v&&(t=function(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0)}return i>0?t.slice(0,i)+t.slice(e+1):t}(t)),A&&0==+t&&"+"!==l&&(A=!1),h=(A?"("===l?l:f:"-"===l||"("===l?"":l)+h,E=("s"===g?rr[8+Zn/3]:"")+E+(A&&"("===l?")":""),x)for(i=-1,o=t.length;++i<o;)if(48>(u=t.charCodeAt(i))||u>57){E=(46===u?a+t.slice(i+1):t.slice(i))+E,t=t.slice(0,i);break}}y&&!p&&(t=r(t,1/0));var M=h.length+t.length+E.length,T=M<d?new Array(d-M+1).join(e):"";switch(y&&p&&(t=r(T+t,T.length?d-E.length:1/0),T=""),n){case"<":t=h+t+E+T;break;case"=":t=h+T+t+E;break;case"^":t=T.slice(0,M=T.length>>1)+h+t+E+T.slice(M);break;default:t=T+h+t+E}return s(t)}return m=void 0===m?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),E.toString=function(){return t+""},E}return{format:l,formatPrefix:function(t,e){var n,r=l(((t=Wn(t)).type="f",t)),i=3*Math.max(-8,Math.min(8,Math.floor((n=e,((n=Xn(Math.abs(n)))?n[1]:NaN)/3)))),o=Math.pow(10,-i),a=rr[8+i/3];return function(t){return r(o*t)+a}}}}(t),er.format,er.formatPrefix,er}ir({thousands:",",grouping:[3],currency:["$",""]}),Ln.getParameterByName,ir({decimal:".",thousands:" ",grouping:[3],currency:["",""]});const or=["BOOLEAN","INT32","INT64","INT96","FLOAT","DOUBLE","BYTE_ARRAY","FIXED_LEN_BYTE_ARRAY"],ar=["PLAIN","GROUP_VAR_INT","PLAIN_DICTIONARY","RLE","BIT_PACKED","DELTA_BINARY_PACKED","DELTA_LENGTH_BYTE_ARRAY","DELTA_BYTE_ARRAY","RLE_DICTIONARY","BYTE_STREAM_SPLIT"],sr=["REQUIRED","OPTIONAL","REPEATED"],ur=["UTF8","MAP","MAP_KEY_VALUE","LIST","ENUM","DECIMAL","DATE","TIME_MILLIS","TIME_MICROS","TIMESTAMP_MILLIS","TIMESTAMP_MICROS","UINT_8","UINT_16","UINT_32","UINT_64","INT_8","INT_16","INT_32","INT_64","JSON","BSON","INTERVAL"],fr=["UNCOMPRESSED","SNAPPY","GZIP","LZO","BROTLI","LZ4","ZSTD","LZ4_RAW"],cr=["DATA_PAGE","INDEX_PAGE","DICTIONARY_PAGE","DATA_PAGE_V2"],lr=["SPHERICAL","VINCENTY","THOMAS","ANDOYER","KARNEY"];function hr(t){const e=pr(t);if(1===e.type)return{type:"Point",coordinates:dr(t,e)};if(2===e.type)return{type:"LineString",coordinates:yr(t,e)};if(3===e.type)return{type:"Polygon",coordinates:mr(t,e)};if(4===e.type){const n=[];for(let r=0;r<e.count;r++)n.push(dr(t,pr(t)));return{type:"MultiPoint",coordinates:n}}if(5===e.type){const n=[];for(let r=0;r<e.count;r++)n.push(yr(t,pr(t)));return{type:"MultiLineString",coordinates:n}}if(6===e.type){const n=[];for(let r=0;r<e.count;r++)n.push(mr(t,pr(t)));return{type:"MultiPolygon",coordinates:n}}if(7===e.type){const n=[];for(let r=0;r<e.count;r++)n.push(hr(t));return{type:"GeometryCollection",geometries:n}}throw new Error(`Unsupported geometry type: ${e.type}`)}function pr(t){const{view:e}=t,n=1===e.getUint8(t.offset++),r=e.getUint32(t.offset,n);t.offset+=4;const i=r%1e3,o=Math.floor(r/1e3);let a=0;i>1&&i<=7&&(a=e.getUint32(t.offset,n),t.offset+=4);let s=2;return o&&s++,3===o&&s++,{littleEndian:n,type:i,dim:s,count:a}}function dr(t,e){const n=[];for(let r=0;r<e.dim;r++){const r=t.view.getFloat64(t.offset,e.littleEndian);t.offset+=8,n.push(r)}return n}function yr(t,e){const n=[];for(let r=0;r<e.count;r++)n.push(dr(t,e));return n}function mr(t,e){const{view:n}=t,r=[];for(let i=0;i<e.count;i++){const i=n.getUint32(t.offset,e.littleEndian);t.offset+=4,r.push(yr(t,{...e,count:i}))}return r}const vr=new TextDecoder,gr={timestampFromMilliseconds:t=>new Date(Number(t)),timestampFromMicroseconds:t=>new Date(Number(t/1000n)),timestampFromNanoseconds:t=>new Date(Number(t/1000000n)),dateFromDays:t=>new Date(864e5*t),stringFromBytes:t=>t&&vr.decode(t),geometryFromBytes:t=>t&&hr({view:new DataView(t.buffer,t.byteOffset,t.byteLength),offset:0}),geographyFromBytes:t=>t&&hr({view:new DataView(t.buffer,t.byteOffset,t.byteLength),offset:0})};function _r(t,e,n,r){if(e&&n.endsWith("_DICTIONARY")){let n=t;t instanceof Uint8Array&&!(e instanceof Uint8Array)&&(n=new e.constructor(t.length));for(let r=0;r<t.length;r++)n[r]=e[t[r]];return n}return wr(t,r)}function wr(t,e){const{element:n,parsers:r,utf8:i=!0}=e,{type:o,converted_type:a,logical_type:s}=n;if("DECIMAL"===a){const e=10**-(n.scale||0),r=new Array(t.length);for(let n=0;n<r.length;n++)t[n]instanceof Uint8Array?r[n]=br(t[n])*e:r[n]=Number(t[n])*e;return r}if(!a&&"INT96"===o)return Array.from(t).map((t=>{return r.timestampFromNanoseconds(86400000000000n*(((e=t)>>64n)-2440588n)+(0xffffffffffffffffn&e));var e}));if("DATE"===a)return Array.from(t).map((t=>r.dateFromDays(t)));if("TIMESTAMP_MILLIS"===a)return Array.from(t).map((t=>r.timestampFromMilliseconds(t)));if("TIMESTAMP_MICROS"===a)return Array.from(t).map((t=>r.timestampFromMicroseconds(t)));if("JSON"===a)return t.map((t=>JSON.parse(vr.decode(t))));if("BSON"===a)throw new Error("parquet bson not supported");if("INTERVAL"===a)throw new Error("parquet interval not supported");if("GEOMETRY"===s?.type)return t.map((t=>r.geometryFromBytes(t)));if("GEOGRAPHY"===s?.type)return t.map((t=>r.geographyFromBytes(t)));if("UTF8"===a||"STRING"===s?.type||i&&"BYTE_ARRAY"===o)return t.map((t=>r.stringFromBytes(t)));if("UINT_64"===a||"INTEGER"===s?.type&&64===s.bitWidth&&!s.isSigned){if(t instanceof BigInt64Array)return new BigUint64Array(t.buffer,t.byteOffset,t.length);const e=new BigUint64Array(t.length);for(let n=0;n<e.length;n++)e[n]=BigInt(t[n]);return e}if("UINT_32"===a||"INTEGER"===s?.type&&32===s.bitWidth&&!s.isSigned){if(t instanceof Int32Array)return new Uint32Array(t.buffer,t.byteOffset,t.length);const e=new Uint32Array(t.length);for(let n=0;n<e.length;n++)e[n]=t[n];return e}if("FLOAT16"===s?.type)return Array.from(t).map(xr);if("TIMESTAMP"===s?.type){const{unit:e}=s;let n=r.timestampFromMilliseconds;"MICROS"===e&&(n=r.timestampFromMicroseconds),"NANOS"===e&&(n=r.timestampFromNanoseconds);const i=new Array(t.length);for(let e=0;e<i.length;e++)i[e]=n(t[e]);return i}return t}function br(t){if(!t.length)return 0;let e=0n;for(const n of t)e=256n*e+BigInt(n);const n=8*t.length;return e>=2n**BigInt(n-1)&&(e-=2n**BigInt(n)),Number(e)}function xr(t){if(!t)return;const e=t[1]<<8|t[0],n=e>>15?-1:1,r=e>>10&31,i=1023&e;return 0===r?n*2**-14*(i/1024):31===r?i?NaN:n*(1/0):n*2**(r-15)*(1+i/1024)}function Er(t,e,n){const r=t[e],i=[];let o=1;if(r.num_children)for(;i.length<r.num_children;){const r=t[e+o],a=Er(t,e+o,[...n,r.name]);o+=a.count,i.push(a)}return{count:o,element:r,children:i,path:n}}function Ar(t,e){let n=Er(t,0,[]);const r=[n];for(const t of e){const i=n.children.find((e=>e.element.name===t));if(!i)throw new Error(`parquet schema element not found: ${e}`);r.push(i),n=i}return r}function Mr(t){let e=0;for(const{element:n}of t)"REPEATED"===n.repetition_type&&e++;return e}function Tr(t){let e=0;for(const{element:n}of t.slice(1))"REQUIRED"!==n.repetition_type&&e++;return e}function Nr(t){if(2!==t.length)return!1;const[,e]=t;return"REPEATED"!==e.element.repetition_type&&!e.children.length}function Sr(t){let e=0;const n={};for(;t.offset<t.view.byteLength;){const[r,i,o]=kr(t,e);if(e=o,0===r)break;n[`field_${i}`]=Ir(t,r)}return n}function Ir(t,e){switch(e){case 1:return!0;case 2:return!1;case 3:return t.view.getInt8(t.offset++);case 4:case 5:return Or(t);case 6:return Pr(t);case 7:{const e=t.view.getFloat64(t.offset,!0);return t.offset+=8,e}case 8:{const e=Lr(t),n=new Uint8Array(t.view.buffer,t.view.byteOffset+t.offset,e);return t.offset+=e,n}case 9:{const e=t.view.getUint8(t.offset++),n=15&e;let r=e>>4;15===r&&(r=Lr(t));const i=1===n||2===n,o=new Array(r);for(let e=0;e<r;e++)o[e]=i?1===Ir(t,3):Ir(t,n);return o}case 12:{const e={};let n=0;for(;;){const[r,i,o]=kr(t,n);if(n=o,0===r)break;e[`field_${i}`]=Ir(t,r)}return e}default:throw new Error(`thrift unhandled type: ${e}`)}}function Lr(t){let e=0,n=0;for(;;){const r=t.view.getUint8(t.offset++);if(e|=(127&r)<<n,!(128&r))return e;n+=7}}function Or(t){const e=Lr(t);return e>>>1^-(1&e)}function Pr(t){const e=function(t){let e=0n,n=0n;for(;;){const r=t.view.getUint8(t.offset++);if(e|=BigInt(127&r)<<n,!(128&r))return e;n+=7n}}(t);return e>>1n^-(1n&e)}function kr(t,e){const n=t.view.getUint8(t.offset++),r=15&n;if(0===r)return[0,0,e];const i=n>>4,o=i?e+i:Or(t);return[r,o,o]}const Rr=new TextDecoder;function Cr(t){return t&&Rr.decode(t)}function Dr(t,{parsers:e,geoparquet:n=!0}={}){if(!(t instanceof ArrayBuffer))throw new Error("parquet expected ArrayBuffer");const r=new DataView(t);if(e={...gr,...e},r.byteLength<8)throw new Error("parquet file is too short");if(827474256!==r.getUint32(r.byteLength-4,!0))throw new Error("parquet file invalid (footer != PAR1)");const i=r.byteLength-8,o=r.getUint32(i,!0);if(o>r.byteLength-8)throw new Error(`parquet metadata length ${o} exceeds available buffer ${r.byteLength-8}`);const a=Sr({view:r,offset:i-o}),s=a.field_1,u=a.field_2.map((t=>({type:or[t.field_1],type_length:t.field_2,repetition_type:sr[t.field_3],name:Cr(t.field_4),num_children:t.field_5,converted_type:ur[t.field_6],scale:t.field_7,precision:t.field_8,field_id:t.field_9,logical_type:zr(t.field_10)}))),f=u.filter((t=>t.type)),c=a.field_3,l=a.field_4.map((t=>({columns:t.field_1.map(((t,n)=>({file_path:Cr(t.field_1),file_offset:t.field_2,meta_data:t.field_3&&{type:or[t.field_3.field_1],encodings:t.field_3.field_2?.map((t=>ar[t])),path_in_schema:t.field_3.field_3.map(Cr),codec:fr[t.field_3.field_4],num_values:t.field_3.field_5,total_uncompressed_size:t.field_3.field_6,total_compressed_size:t.field_3.field_7,key_value_metadata:t.field_3.field_8?.map((t=>({key:Cr(t.field_1),value:Cr(t.field_2)}))),data_page_offset:t.field_3.field_9,index_page_offset:t.field_3.field_10,dictionary_page_offset:t.field_3.field_11,statistics:$r(t.field_3.field_12,f[n],e),encoding_stats:t.field_3.field_13?.map((t=>({page_type:cr[t.field_1],encoding:ar[t.field_2],count:t.field_3}))),bloom_filter_offset:t.field_3.field_14,bloom_filter_length:t.field_3.field_15,size_statistics:t.field_3.field_16&&{unencoded_byte_array_data_bytes:t.field_3.field_16.field_1,repetition_level_histogram:t.field_3.field_16.field_2,definition_level_histogram:t.field_3.field_16.field_3},geospatial_statistics:t.field_3.field_17&&{bbox:t.field_3.field_17.field_1&&{xmin:t.field_3.field_17.field_1.field_1,xmax:t.field_3.field_17.field_1.field_2,ymin:t.field_3.field_17.field_1.field_3,ymax:t.field_3.field_17.field_1.field_4,zmin:t.field_3.field_17.field_1.field_5,zmax:t.field_3.field_17.field_1.field_6,mmin:t.field_3.field_17.field_1.field_7,mmax:t.field_3.field_17.field_1.field_8},geospatial_types:t.field_3.field_17.field_2}},offset_index_offset:t.field_4,offset_index_length:t.field_5,column_index_offset:t.field_6,column_index_length:t.field_7,crypto_metadata:t.field_8,encrypted_column_metadata:t.field_9}))),total_byte_size:t.field_2,num_rows:t.field_3,sorting_columns:t.field_4?.map((t=>({column_idx:t.field_1,descending:t.field_2,nulls_first:t.field_3}))),file_offset:t.field_5,total_compressed_size:t.field_6,ordinal:t.field_7}))),h=a.field_5?.map((t=>({key:Cr(t.field_1),value:Cr(t.field_2)}))),p=Cr(a.field_6);return n&&function(t,e){const n=new Map,r=e?.find((({key:t})=>"geo"===t))?.value,i=(r&&JSON.parse(r)?.columns)??{};for(const[t,e]of Object.entries(i)){if("WKB"!==e.encoding)continue;const r="spherical"===e.edges?"GEOGRAPHY":"GEOMETRY",i=e.crs?.id??e.crs?.ids?.[0],o=i?`${i.authority}:${i.code.toString()}`:void 0;n.set(t,{type:r,crs:o})}for(let e=1;e<t.length;e++){const r=t[e],{logical_type:i,name:o,num_children:a,repetition_type:s,type:u}=r;a?e+=a:"BYTE_ARRAY"===u&&void 0===i&&"REPEATED"!==s&&(r.logical_type=n.get(o))}}(u,h),{version:s,schema:u,num_rows:c,row_groups:l,key_value_metadata:h,created_by:p,metadata_length:o}}function Br({schema:t}){return Ar(t,[])[0]}function zr(t){return t?.field_1?{type:"STRING"}:t?.field_2?{type:"MAP"}:t?.field_3?{type:"LIST"}:t?.field_4?{type:"ENUM"}:t?.field_5?{type:"DECIMAL",scale:t.field_5.field_1,precision:t.field_5.field_2}:t?.field_6?{type:"DATE"}:t?.field_7?{type:"TIME",isAdjustedToUTC:t.field_7.field_1,unit:jr(t.field_7.field_2)}:t?.field_8?{type:"TIMESTAMP",isAdjustedToUTC:t.field_8.field_1,unit:jr(t.field_8.field_2)}:t?.field_10?{type:"INTEGER",bitWidth:t.field_10.field_1,isSigned:t.field_10.field_2}:t?.field_11?{type:"NULL"}:t?.field_12?{type:"JSON"}:t?.field_13?{type:"BSON"}:t?.field_14?{type:"UUID"}:t?.field_15?{type:"FLOAT16"}:t?.field_16?{type:"VARIANT",specification_version:t.field_16.field_1}:t?.field_17?{type:"GEOMETRY",crs:Cr(t.field_17.field_1)}:t?.field_18?{type:"GEOGRAPHY",crs:Cr(t.field_18.field_1),algorithm:lr[t.field_18.field_2]}:t}function jr(t){if(t.field_1)return"MILLIS";if(t.field_2)return"MICROS";if(t.field_3)return"NANOS";throw new Error("parquet time unit required")}function $r(t,e,n){return t&&{max:Ur(t.field_1,e,n),min:Ur(t.field_2,e,n),null_count:t.field_3,distinct_count:t.field_4,max_value:Ur(t.field_5,e,n),min_value:Ur(t.field_6,e,n),is_max_value_exact:t.field_7,is_min_value_exact:t.field_8}}function Ur(t,e,n){const{type:r,converted_type:i,logical_type:o}=e;if(void 0===t)return t;if("BOOLEAN"===r)return 1===t[0];if("BYTE_ARRAY"===r)return n.stringFromBytes(t);const a=new DataView(t.buffer,t.byteOffset,t.byteLength);return"FLOAT"===r&&4===a.byteLength?a.getFloat32(0,!0):"DOUBLE"===r&&8===a.byteLength?a.getFloat64(0,!0):"INT32"===r&&"DATE"===i?n.dateFromDays(a.getInt32(0,!0)):"INT64"===r&&"TIMESTAMP_MILLIS"===i?n.timestampFromMilliseconds(a.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP_MICROS"===i?n.timestampFromMicroseconds(a.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP"===o?.type&&"NANOS"===o?.unit?n.timestampFromNanoseconds(a.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP"===o?.type&&"MICROS"===o?.unit?n.timestampFromMicroseconds(a.getBigInt64(0,!0)):"INT64"===r&&"TIMESTAMP"===o?.type?n.timestampFromMilliseconds(a.getBigInt64(0,!0)):"INT32"===r&&4===a.byteLength?a.getInt32(0,!0):"INT64"===r&&8===a.byteLength?a.getBigInt64(0,!0):"DECIMAL"===i?br(t)*10**-(e.scale||0):"FLOAT16"===o?.type?xr(t):t}function Yr(t,e){for(let n=0;n<e.length;n+=1e4)t.push(...e.slice(n,n+1e4))}function Fr(t,e){return t===e||(t instanceof Uint8Array&&e instanceof Uint8Array?Fr(Array.from(t),Array.from(e)):!(!t||!e||typeof t!=typeof e)&&(Array.isArray(t)&&Array.isArray(e)?t.length===e.length&&t.every(((t,n)=>Fr(t,e[n]))):"object"==typeof t&&Object.keys(t).length===Object.keys(e).length&&Object.keys(t).every((n=>Fr(t[n],e[n])))))}function Gr(t){if(!t)return[];if(1===t.length)return t[0];const e=[];for(const n of t)Yr(e,n);return e}function qr(t,e,n){if(!t)return!1;if("$and"in t&&Array.isArray(t.$and))return t.$and.some((t=>qr(t,e,n)));if("$or"in t&&Array.isArray(t.$or))return t.$or.every((t=>qr(t,e,n)));if("$nor"in t&&Array.isArray(t.$nor))return!1;for(const[r,i]of Object.entries(t)){const t=n.indexOf(r);if(-1===t)continue;const o=e.columns[t],a=o.meta_data?.statistics;if(!a)continue;const{min:s,max:u,min_value:f,max_value:c}=a,l=void 0!==f?f:s,h=void 0!==c?c:u;if(void 0!==l&&void 0!==h)for(const[t,e]of Object.entries(i||{})){if("$gt"===t&&h<=e)return!0;if("$gte"===t&&h<e)return!0;if("$lt"===t&&l>=e)return!0;if("$lte"===t&&l>e)return!0;if("$eq"===t&&(e<l||e>h))return!0;if("$ne"===t&&Fr(l,h)&&Fr(l,e))return!0;if("$in"===t&&Array.isArray(e)&&e.every((t=>t<l||t>h)))return!0;if("$nin"===t&&Array.isArray(e)&&Fr(l,h)&&e.includes(l))return!0}}return!1}function Vr({dictionary_page_offset:t,data_page_offset:e,total_compressed_size:n}){const r=t||e;return{startByte:Number(r),endByte:Number(r+n)}}function Xr(t,e,n,r,i){const o=e?.length||n.length;if(!o)return r;const a=Tr(i),s=i.map((({element:t})=>t.repetition_type));let u=0;const f=[t];let c=t,l=0,h=0,p=0;if(n[0])for(;l<s.length-2&&p<n[0];)l++,"REQUIRED"!==s[l]&&(c=c.at(-1),f.push(c),h++),"REPEATED"===s[l]&&p++;for(let t=0;t<o;t++){const i=e?.length?e[t]:a,o=n[t];for(;l&&(o<p||"REPEATED"!==s[l]);)"REQUIRED"!==s[l]&&(f.pop(),h--),"REPEATED"===s[l]&&p--,l--;for(c=f.at(-1);(l<s.length-2||"REPEATED"===s[l+1])&&(h<i||"REQUIRED"===s[l+1]);){if(l++,"REQUIRED"!==s[l]){const t=[];c.push(t),c=t,f.push(t),h++}"REPEATED"===s[l]&&p++}i===a?c.push(r[u++]):l===s.length-2?c.push(null):c.push([])}if(!t.length)for(let t=0;t<a;t++){const t=[];c.push(t),c=t}return t}function Zr(t,e,n=0){const r=e.path.join("."),i="OPTIONAL"===e.element.repetition_type,o=i?n+1:n;if(function(t){if(!t)return!1;if("LIST"!==t.element.converted_type)return!1;if(t.children.length>1)return!1;const e=t.children[0];return!(e.children.length>1)&&"REPEATED"===e.element.repetition_type}(e)){let a=e.children[0],s=o;1===a.children.length&&(a=a.children[0],s++),Zr(t,a,s);const u=a.path.join("."),f=t.get(u);if(!f)throw new Error("parquet list column missing values");return i&&Hr(f,n),t.set(r,f),void t.delete(u)}if(function(t){if(!t)return!1;if("MAP"!==t.element.converted_type)return!1;if(t.children.length>1)return!1;const e=t.children[0];if(2!==e.children.length)return!1;if("REPEATED"!==e.element.repetition_type)return!1;const n=e.children.find((t=>"key"===t.element.name));if("REPEATED"===n?.element.repetition_type)return!1;const r=e.children.find((t=>"value"===t.element.name));return"REPEATED"!==r?.element.repetition_type}(e)){const a=e.children[0].element.name;Zr(t,e.children[0].children[0],o+1),Zr(t,e.children[0].children[1],o+1);const s=t.get(`${r}.${a}.key`),u=t.get(`${r}.${a}.value`);if(!s)throw new Error("parquet map column missing keys");if(!u)throw new Error("parquet map column missing values");if(s.length!==u.length)throw new Error("parquet map column key/value length mismatch");const f=Wr(s,u,o);return i&&Hr(f,n),t.delete(`${r}.${a}.key`),t.delete(`${r}.${a}.value`),void t.set(r,f)}if(e.children.length){const o="REQUIRED"===e.element.repetition_type?n:n+1,a={};for(const n of e.children){Zr(t,n,o);const e=t.get(n.path.join("."));if(!e)throw new Error("parquet struct missing child data");a[n.element.name]=e}for(const n of e.children)t.delete(n.path.join("."));const s=Kr(a,o);i&&Hr(s,n),t.set(r,s)}}function Hr(t,e){for(let n=0;n<t.length;n++)e?Hr(t[n],e-1):t[n]=t[n][0]}function Wr(t,e,n){const r=[];for(let i=0;i<t.length;i++)if(n)r.push(Wr(t[i],e[i],n-1));else if(t[i]){const n={};for(let r=0;r<t[i].length;r++){const o=e[i][r];n[t[i][r]]=void 0===o?null:o}r.push(n)}else r.push(void 0);return r}function Kr(t,e){const n=Object.keys(t),r=t[n[0]]?.length,i=[];for(let o=0;o<r;o++){const a={};for(const e of n){if(t[e].length!==r)throw new Error("parquet struct parsing error");a[e]=t[e][o]}e?i.push(Kr(a,e-1)):i.push(a)}return i}function Qr(t,e,n){const r=n instanceof Int32Array,i=Lr(t),o=Lr(t);Lr(t);let a=Pr(t),s=0;n[s++]=r?Number(a):a;const u=i/o;for(;s<e;){const i=Pr(t),f=new Uint8Array(o);for(let e=0;e<o;e++)f[e]=t.view.getUint8(t.offset++);for(let c=0;c<o&&s<e;c++){const o=BigInt(f[c]);if(o){let f=0n,c=u;const l=(1n<<o)-1n;for(;c&&s<e;){let e=BigInt(t.view.getUint8(t.offset))>>f&l;for(f+=o;f>=8;)f-=8n,t.offset++,f&&(e|=BigInt(t.view.getUint8(t.offset))<<o-f&l);a+=i+e,n[s++]=r?Number(a):a,c--}c&&(t.offset+=Math.ceil((c*Number(o)+Number(f))/8))}else for(let t=0;t<u&&s<e;t++)a+=i,n[s++]=r?Number(a):a}}}function Jr(t,e,n){const r=new Int32Array(e);Qr(t,e,r);for(let i=0;i<e;i++)n[i]=new Uint8Array(t.view.buffer,t.view.byteOffset+t.offset,r[i]),t.offset+=r[i]}function ti(t){return 32-Math.clz32(t)}function ei(t,e,n,r){void 0===r&&(r=t.view.getUint32(t.offset,!0),t.offset+=4);const i=t.offset;let o=0;for(;o<n.length;){const r=Lr(t);if(1&r)o=ri(t,r,e,n,o);else{const i=r>>>1;ni(t,i,e,n,o),o+=i}}t.offset=i+r}function ni(t,e,n,r,i){const o=n+7>>3;let a=0;for(let e=0;e<o;e++)a|=t.view.getUint8(t.offset++)<<(e<<3);for(let t=0;t<e;t++)r[i+t]=a}function ri(t,e,n,r,i){let o=e>>1<<3;const a=(1<<n)-1;let s=0;if(t.offset<t.view.byteLength)s=t.view.getUint8(t.offset++);else if(a)throw new Error(`parquet bitpack offset ${t.offset} out of range`);let u=8,f=0;for(;o;)f>8?(f-=8,u-=8,s>>>=8):u-f<n?(s|=t.view.getUint8(t.offset)<<u,t.offset++,u+=8):(i<r.length&&(r[i++]=s>>f&a),o--,f+=n);return i}function ii(t,e,n,r){const i=function(t,e){switch(t){case"INT32":case"FLOAT":return 4;case"INT64":case"DOUBLE":return 8;case"FIXED_LEN_BYTE_ARRAY":if(!e)throw new Error("parquet byteWidth missing type_length");return e;default:throw new Error(`parquet unsupported type: ${t}`)}}(n,r),o=new Uint8Array(e*i);for(let n=0;n<i;n++)for(let r=0;r<e;r++)o[r*i+n]=t.view.getUint8(t.offset++);if("FLOAT"===n)return new Float32Array(o.buffer);if("DOUBLE"===n)return new Float64Array(o.buffer);if("INT32"===n)return new Int32Array(o.buffer);if("INT64"===n)return new BigInt64Array(o.buffer);if("FIXED_LEN_BYTE_ARRAY"===n){const t=new Array(e);for(let n=0;n<e;n++)t[n]=o.subarray(n*i,(n+1)*i);return t}throw new Error(`parquet byte_stream_split unsupported type: ${n}`)}function oi(t,e,n,r){if(0===n)return[];if("BOOLEAN"===e)return function(t,e){const n=new Array(e);for(let r=0;r<e;r++){const e=t.offset+(r/8|0),i=r%8,o=t.view.getUint8(e);n[r]=!!(o&1<<i)}return t.offset+=Math.ceil(e/8),n}(t,n);if("INT32"===e)return function(t,e){const n=(t.view.byteOffset+t.offset)%4?new Int32Array(ai(t.view.buffer,t.view.byteOffset+t.offset,4*e)):new Int32Array(t.view.buffer,t.view.byteOffset+t.offset,e);return t.offset+=4*e,n}(t,n);if("INT64"===e)return function(t,e){const n=(t.view.byteOffset+t.offset)%8?new BigInt64Array(ai(t.view.buffer,t.view.byteOffset+t.offset,8*e)):new BigInt64Array(t.view.buffer,t.view.byteOffset+t.offset,e);return t.offset+=8*e,n}(t,n);if("INT96"===e)return function(t,e){const n=new Array(e);for(let r=0;r<e;r++){const e=t.view.getBigInt64(t.offset+12*r,!0),i=t.view.getInt32(t.offset+12*r+8,!0);n[r]=BigInt(i)<<64n|e}return t.offset+=12*e,n}(t,n);if("FLOAT"===e)return function(t,e){const n=(t.view.byteOffset+t.offset)%4?new Float32Array(ai(t.view.buffer,t.view.byteOffset+t.offset,4*e)):new Float32Array(t.view.buffer,t.view.byteOffset+t.offset,e);return t.offset+=4*e,n}(t,n);if("DOUBLE"===e)return function(t,e){const n=(t.view.byteOffset+t.offset)%8?new Float64Array(ai(t.view.buffer,t.view.byteOffset+t.offset,8*e)):new Float64Array(t.view.buffer,t.view.byteOffset+t.offset,e);return t.offset+=8*e,n}(t,n);if("BYTE_ARRAY"===e)return function(t,e){const n=new Array(e);for(let r=0;r<e;r++){const e=t.view.getUint32(t.offset,!0);t.offset+=4,n[r]=new Uint8Array(t.view.buffer,t.view.byteOffset+t.offset,e),t.offset+=e}return n}(t,n);if("FIXED_LEN_BYTE_ARRAY"===e){if(!r)throw new Error("parquet missing fixed length");return function(t,e,n){const r=new Array(e);for(let i=0;i<e;i++)r[i]=new Uint8Array(t.view.buffer,t.view.byteOffset+t.offset,n),t.offset+=n;return r}(t,n,r)}throw new Error(`parquet unhandled type: ${e}`)}function ai(t,e,n){const r=new ArrayBuffer(n);return new Uint8Array(r).set(new Uint8Array(t,e,n)),r}const si=[0,255,65535,16777215,4294967295];function ui(t,e,n,r,i){for(let o=0;o<i;o++)n[r+o]=t[e+o]}function fi(t,e,n,r){let i;const o=r?.[n];if("UNCOMPRESSED"===n)i=t;else if(o)i=o(t,e);else{if("SNAPPY"!==n)throw new Error(`parquet unsupported compression codec: ${n}`);i=new Uint8Array(e),function(t,e){const n=t.byteLength,r=e.byteLength;let i=0,o=0;for(;i<n;){const e=t[i];if(i++,e<128)break}if(r&&i>=n)throw new Error("invalid snappy length header");for(;i<n;){const r=t[i];let a=0;if(i++,i>=n)throw new Error("missing eof marker");if(3&r){let s=0;switch(3&r){case 1:a=4+(r>>>2&7),s=t[i]+(r>>>5<<8),i++;break;case 2:if(n<=i+1)throw new Error("snappy error end of input");a=1+(r>>>2),s=t[i]+(t[i+1]<<8),i+=2;break;case 3:if(n<=i+3)throw new Error("snappy error end of input");a=1+(r>>>2),s=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+(t[i+3]<<24),i+=4}if(0===s||isNaN(s))throw new Error(`invalid offset ${s} pos ${i} inputLength ${n}`);if(s>o)throw new Error("cannot copy from before start of buffer");ui(e,o-s,e,o,a),o+=a}else{let a=1+(r>>>2);if(a>60){if(i+3>=n)throw new Error("snappy error literal pos + 3 >= inputLength");const e=a-60;a=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+(t[i+3]<<24),a=1+(a&si[e]),i+=e}if(i+a>n)throw new Error("snappy error literal exceeds input length");ui(t,i,e,o,a),i+=a,o+=a}}if(o!==r)throw new Error("premature end of input")}(t,i)}if(i?.length!==e)throw new Error(`parquet decompressed page length ${i?.length} does not match header ${e}`);return i}function ci(t,{groupStart:e,selectStart:n,selectEnd:r},i,o){const{columnName:a,schemaPath:s}=i,u=Nr(s),f=[];let c,l,h=0;const p=o&&(()=>{l&&o({columnName:a,columnData:l,rowStart:e+h-l.length,rowEnd:e+h})});for(;(u?h<r:t.offset<t.view.byteLength-1)&&!(t.offset>=t.view.byteLength-1);){const e=hi(t);if("DICTIONARY_PAGE"===e.type)c=li(t,e,i,c,void 0,0),c=wr(c,i);else{const r=l?.length||0,o=li(t,e,i,c,l,n-h);l===o?h+=o.length-r:(p?.(),f.push(o),h+=o.length,l=o)}}return p?.(),h>r&&l&&(f[f.length-1]=l.slice(0,r-(h-l.length))),f}function li(t,e,n,r,i,o){const{type:a,element:s,schemaPath:u,codec:f,compressors:c}=n,l=new Uint8Array(t.view.buffer,t.view.byteOffset+t.offset,e.compressed_page_size);if(t.offset+=e.compressed_page_size,"DATA_PAGE"===e.type){const t=e.data_page_header;if(!t)throw new Error("parquet data page header is undefined");if(o>t.num_values&&Nr(u))return new Array(t.num_values);const a=fi(l,Number(e.uncompressed_page_size),f,c),{definitionLevels:s,repetitionLevels:h,dataPage:p}=function(t,e,{type:n,element:r,schemaPath:i}){const o=new DataView(t.buffer,t.byteOffset,t.byteLength),a={view:o,offset:0};let s;const u=function(t,e,n){if(n.length>1){const r=Mr(n);if(r){const n=new Array(e.num_values);return ei(t,ti(r),n),n}}return[]}(a,e,i),{definitionLevels:f,numNulls:c}=function(t,e,n){const r=Tr(n);if(!r)return{definitionLevels:[],numNulls:0};const i=new Array(e.num_values);ei(t,ti(r),i);let o=e.num_values;for(const t of i)t===r&&o--;return 0===o&&(i.length=0),{definitionLevels:i,numNulls:o}}(a,e,i),l=e.num_values-c;if("PLAIN"===e.encoding)s=oi(a,n,l,r.type_length);else if("PLAIN_DICTIONARY"===e.encoding||"RLE_DICTIONARY"===e.encoding||"RLE"===e.encoding){const t="BOOLEAN"===n?1:o.getUint8(a.offset++);t?(s=new Array(l),"BOOLEAN"===n?(ei(a,t,s),s=s.map((t=>!!t))):ei(a,t,s,o.byteLength-a.offset)):s=new Uint8Array(l)}else if("BYTE_STREAM_SPLIT"===e.encoding)s=ii(a,l,n,r.type_length);else if("DELTA_BINARY_PACKED"===e.encoding)s="INT32"===n?new Int32Array(l):new BigInt64Array(l),Qr(a,l,s);else{if("DELTA_LENGTH_BYTE_ARRAY"!==e.encoding)throw new Error(`parquet unsupported encoding: ${e.encoding}`);s=new Array(l),Jr(a,l,s)}return{definitionLevels:f,repetitionLevels:u,dataPage:s}}(a,t,n);let d=_r(p,r,t.encoding,n);if(h.length||s?.length)return Xr(Array.isArray(i)?i:[],s,h,d,u);for(let t=2;t<u.length;t++)"REQUIRED"!==u[t].element.repetition_type&&(d=Array.from(d,(t=>[t])));return d}if("DATA_PAGE_V2"===e.type){const t=e.data_page_header_v2;if(!t)throw new Error("parquet data page header v2 is undefined");if(o>t.num_rows)return new Array(t.num_values);const{definitionLevels:a,repetitionLevels:s,dataPage:f}=function(t,e,n){const r={view:new DataView(t.buffer,t.byteOffset,t.byteLength),offset:0},{type:i,element:o,schemaPath:a,codec:s,compressors:u}=n,f=e.data_page_header_v2;if(!f)throw new Error("parquet data page header v2 is undefined");const c=function(t,e,n){const r=Mr(n);if(!r)return[];const i=new Array(e.num_values);return ei(t,ti(r),i,e.repetition_levels_byte_length),i}(r,f,a);r.offset=f.repetition_levels_byte_length;const l=function(t,e,n){const r=Tr(n);if(r){const n=new Array(e.num_values);return ei(t,ti(r),n,e.definition_levels_byte_length),n}}(r,f,a),h=e.uncompressed_page_size-f.definition_levels_byte_length-f.repetition_levels_byte_length;let p=t.subarray(r.offset);!1!==f.is_compressed&&(p=fi(p,h,s,u));const d=new DataView(p.buffer,p.byteOffset,p.byteLength),y={view:d,offset:0};let m;const v=f.num_values-f.num_nulls;if("PLAIN"===f.encoding)m=oi(y,i,v,o.type_length);else if("RLE"===f.encoding)m=new Array(v),ei(y,1,m),m=m.map((t=>!!t));else if("PLAIN_DICTIONARY"===f.encoding||"RLE_DICTIONARY"===f.encoding){const t=d.getUint8(y.offset++);m=new Array(v),ei(y,t,m,h-1)}else if("DELTA_BINARY_PACKED"===f.encoding)m="INT32"===i?new Int32Array(v):new BigInt64Array(v),Qr(y,v,m);else if("DELTA_LENGTH_BYTE_ARRAY"===f.encoding)m=new Array(v),Jr(y,v,m);else if("DELTA_BYTE_ARRAY"===f.encoding)m=new Array(v),function(t,e,n){const r=new Int32Array(e);Qr(t,e,r);const i=new Int32Array(e);Qr(t,e,i);for(let o=0;o<e;o++){const e=new Uint8Array(t.view.buffer,t.view.byteOffset+t.offset,i[o]);r[o]?(n[o]=new Uint8Array(r[o]+i[o]),n[o].set(n[o-1].subarray(0,r[o])),n[o].set(e,r[o])):n[o]=e,t.offset+=i[o]}}(y,v,m);else{if("BYTE_STREAM_SPLIT"!==f.encoding)throw new Error(`parquet unsupported encoding: ${f.encoding}`);m=ii(y,v,i,o.type_length)}return{definitionLevels:l,repetitionLevels:c,dataPage:m}}(l,e,n),c=_r(f,r,t.encoding,n);return Xr(Array.isArray(i)?i:[],a,s,c,u)}if("DICTIONARY_PAGE"===e.type){const t=e.dictionary_page_header;if(!t)throw new Error("parquet dictionary page header is undefined");const n=fi(l,Number(e.uncompressed_page_size),f,c);return oi({view:new DataView(n.buffer,n.byteOffset,n.byteLength),offset:0},a,t.num_values,s.type_length)}throw new Error(`parquet unsupported page type: ${e.type}`)}function hi(t){const e=Sr(t);return{type:cr[e.field_1],uncompressed_page_size:e.field_2,compressed_page_size:e.field_3,crc:e.field_4,data_page_header:e.field_5&&{num_values:e.field_5.field_1,encoding:ar[e.field_5.field_2],definition_level_encoding:ar[e.field_5.field_3],repetition_level_encoding:ar[e.field_5.field_4],statistics:e.field_5.field_5&&{max:e.field_5.field_5.field_1,min:e.field_5.field_5.field_2,null_count:e.field_5.field_5.field_3,distinct_count:e.field_5.field_5.field_4,max_value:e.field_5.field_5.field_5,min_value:e.field_5.field_5.field_6}},index_page_header:e.field_6,dictionary_page_header:e.field_7&&{num_values:e.field_7.field_1,encoding:ar[e.field_7.field_2],is_sorted:e.field_7.field_3},data_page_header_v2:e.field_8&&{num_values:e.field_8.field_1,num_nulls:e.field_8.field_2,num_rows:e.field_8.field_3,encoding:ar[e.field_8.field_4],definition_levels_byte_length:e.field_8.field_5,repetition_levels_byte_length:e.field_8.field_6,is_compressed:void 0===e.field_8.field_7||e.field_8.field_7,statistics:e.field_8.field_8}}}async function pi({asyncColumns:t},e,n,r,i){const o=await Promise.all(t.map((({data:t})=>t.then(Gr)))),a=t.map((t=>t.pathInSchema[0])).filter((t=>!r||r.includes(t))),s=r??a,u=s.map((e=>t.findIndex((t=>t.pathInSchema[0]===e)))),f=n-e;if("object"===i){const n=new Array(f);for(let r=0;r<f;r++){const i=e+r,a={};for(let e=0;e<t.length;e++)a[t[e].pathInSchema[0]]=o[e][i];n[r]=a}return n}const c=new Array(f);for(let n=0;n<f;n++){const r=e+n,i=new Array(t.length);for(let t=0;t<s.length;t++)u[t]>=0&&(i[t]=o[u[t]][r]);c[n]=i}return c}async function di(t){t.metadata??=await async function(t,{parsers:e,initialFetchSize:n=524288,geoparquet:r=!0}={}){if(!(t&&t.byteLength>=0))throw new Error("parquet expected AsyncBuffer");const i=Math.max(0,t.byteLength-n),o=await t.slice(i,t.byteLength),a=new DataView(o);if(827474256!==a.getUint32(o.byteLength-4,!0))throw new Error("parquet file invalid (footer != PAR1)");const s=a.getUint32(o.byteLength-8,!0);if(s>t.byteLength-8)throw new Error(`parquet metadata length ${s} exceeds available buffer ${t.byteLength-8}`);if(s+8>n){const n=t.byteLength-s-8,a=await t.slice(n,i),u=new ArrayBuffer(s+8),f=new Uint8Array(u);return f.set(new Uint8Array(a)),f.set(new Uint8Array(o),i-n),Dr(u,{parsers:e,geoparquet:r})}return Dr(o,{parsers:e,geoparquet:r})}(t.file,t);const e=function(t){if(!t.metadata)throw new Error("parquet requires metadata");const e=function({metadata:t,rowStart:e=0,rowEnd:n=1/0,columns:r,filter:i}){if(!t)throw new Error("parquetPlan requires metadata");const o=[],a=[],s=function(t){const e=[];return function t(n){if(n.children.length)for(const e of n.children)t(e);else e.push(n.element.name)}(t),e}(Br(t));let u=0;for(const f of t.row_groups){const t=Number(f.num_rows),c=u+t;if(t>0&&c>e&&u<n&&!qr(i,f,s)){const i=[];for(const{file_path:t,meta_data:e}of f.columns){if(t)throw new Error("parquet file_path not supported");if(!e)throw new Error("parquet column metadata is undefined");r&&!r.includes(e.path_in_schema[0])||i.push(Vr(e))}const s=Math.max(e-u,0),c=Math.min(n-u,t);o.push({ranges:i,rowGroup:f,groupStart:u,groupRows:t,selectStart:s,selectEnd:c});const l=i[i.length-1]?.endByte-i[0]?.startByte;if(!r&&l<33554432)a.push({startByte:i[0].startByte,endByte:i[i.length-1].endByte});else if(i.length)Yr(a,i);else if(r?.length)throw new Error(`parquet columns not found: ${r.join(", ")}`)}u=c}return isFinite(n)||(n=u),{metadata:t,rowStart:e,rowEnd:n,columns:r,fetches:a,groups:o}}(t);return t.file=function(t,{fetches:e}){const n=e.map((({startByte:e,endByte:n})=>t.slice(e,n)));return{byteLength:t.byteLength,slice(r,i=t.byteLength){const o=e.findIndex((({startByte:t,endByte:e})=>t<=r&&i<=e));if(o<0)throw new Error(`no prefetch for range [${r}, ${i}]`);if(e[o].startByte!==r||e[o].endByte!==i){const t=r-e[o].startByte,a=i-e[o].startByte;return n[o]instanceof Promise?n[o].then((e=>e.slice(t,a))):n[o].slice(t,a)}return n[o]}}}(t.file,e),e.groups.map((n=>function(t,{metadata:e,columns:n},r){const{file:i,compressors:o,utf8:a}=t,s=[],u={...gr,...t.parsers};for(const{file_path:f,meta_data:c}of r.rowGroup.columns){if(f)throw new Error("parquet file_path not supported");if(!c)throw new Error("parquet column metadata is undefined");const l=c.path_in_schema[0];if(n&&!n.includes(l))continue;const{startByte:h,endByte:p}=Vr(c),d=p-h;if(d>1<<30){console.warn(`parquet skipping huge column "${c.path_in_schema}" ${d} bytes`);continue}const y=Promise.resolve(i.slice(h,p));s.push({pathInSchema:c.path_in_schema,data:y.then((n=>{const i=Ar(e.schema,c.path_in_schema),s={view:new DataView(n),offset:0},f={columnName:c.path_in_schema.join("."),type:c.type,element:i[i.length-1].element,schemaPath:i,codec:c.codec,parsers:u,compressors:o,utf8:a};return ci(s,r,f,t.onPage)}))})}return{groupStart:r.groupStart,groupRows:r.groupRows,asyncColumns:s}}(t,e,n)))}(t),{rowStart:n=0,rowEnd:r,columns:i,onChunk:o,onComplete:a,rowFormat:s}=t;if(!a&&!o){for(const{asyncColumns:t}of e)for(const{data:e}of t)await e;return}const u=Br(t.metadata),f=e.map((t=>function(t,e){const{asyncColumns:n}=t,r=[];for(const t of e.children)if(t.children.length){const e=n.filter((e=>e.pathInSchema[0]===t.element.name));if(!e.length)continue;const i=new Map,o=Promise.all(e.map((t=>t.data.then((e=>{i.set(t.pathInSchema.join("."),Gr(e))}))))).then((()=>{Zr(i,t);const e=i.get(t.path.join("."));if(!e)throw new Error("parquet column data not assembled");return[e]}));r.push({pathInSchema:t.path,data:o})}else{const e=n.find((e=>e.pathInSchema[0]===t.element.name));e&&r.push(e)}return{...t,asyncColumns:r}}(t,u)));if(o)for(const t of f)for(const e of t.asyncColumns)e.data.then((n=>{let r=t.groupStart;for(const t of n)o({columnName:e.pathInSchema[0],columnData:t,rowStart:r,rowEnd:r+t.length}),r+=t.length}));if(a){const t=[];for(const e of f){const o=Math.max(n-e.groupStart,0),a=Math.min((r??1/0)-e.groupStart,e.groupRows);Yr(t,"object"===s?await pi(e,o,a,i,"object"):await pi(e,o,a,i,"array"))}a(t)}else for(const{asyncColumns:t}of f)for(const{data:e}of t)await e}function yi(t){return yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yi(t)}function mi(){mi=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new L(r||[]);return i(a,"_invoke",{value:T(t,n,s)}),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function _(){}var w={};f(w,a,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(O([])));x&&x!==n&&r.call(x,a)&&(w=x);var E=_.prototype=v.prototype=Object.create(w);function A(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=l(t[i],t,o);if("throw"!==u.type){var f=u.arg,c=f.value;return c&&"object"==yi(c)&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(c).then((function(t){f.value=t,a(f)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=N(s,r);if(u){if(u===m)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var f=l(e,n,r);if("normal"===f.type){if(i=r.done?y:p,f.arg===m)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(i=y,r.method="throw",r.arg=f.arg)}}}function N(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=l(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function O(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(yi(e)+" is not iterable")}return g.prototype=_,i(E,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:g,configurable:!0}),g.displayName=f(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,f(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},A(M.prototype),f(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(E),f(E,u,"Generator"),f(E,a,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=O,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),f=r.call(a,"finallyLoc");if(u&&f){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!f)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function vi(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return gi(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gi(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function gi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function _i(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function wi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,bi(r.key),r)}}function bi(t){var e=function(t){if("object"!=yi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yi(e)?e:e+""}function xi(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(xi=function(){return!!t})()}function Ei(t){return Ei=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ei(t)}function Ai(t,e){return Ai=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ai(t,e)}var Mi=function(t){function e(t,n,r){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(i=function(t,e,n){return e=Ei(e),function(t,e){if(e&&("object"==yi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,xi()?Reflect.construct(e,n||[],Ei(t).constructor):e.apply(t,n))}(this,e,[t,n,r,o])).cells=[],i.infoLoadingStatus="notLoaded",i.getData(void 0),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ai(t,e)}(e,t),n=e,r=[{key:"getData",value:function(t){var e,n=this;return"notLoaded"!=this.infoLoadingStatus||(this.infoLoadingStatus="loading",(e=mi().mark((function t(){var e,r;return mi().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(n.url);case 3:return e=t.sent,t.next=6,e.arrayBuffer();case 6:return r=t.sent,t.next=9,di({file:r,onComplete:function(t){for(var e=Dr(r).schema,i=[],o=[],a=1;a<e.length;a++){i.push(e[a].name);var s=e[a].type+"",u=s.includes("INT")||"FLOAT"==s||"DOUBLE"==s?"number":"string";o.push(u)}if(t=t.map((function(t){for(var e={},n=0;n<i.length;n++){var r=t[n];null!=r&&null!=r?("number"==o[n]?r=Number(t[n]):r+="",e[i[n]]=r):e[i[n]]=r}return e})),n.preprocess){n.cells=[];var f,c=vi(t);try{for(c.s();!(f=c.n()).done;){var l=f.value;0!=n.preprocess(l)&&n.cells.push(l)}}catch(t){c.e(t)}finally{c.f()}}else n.cells=t;n.map&&n.map.redraw(),n.infoLoadingStatus="loaded"}});case 9:t.next=17;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("Could not load data from "+n.url),console.error(t.t0),n.infoLoadingStatus="failed",n.cells=[];case 17:case"end":return t.stop()}}),t,null,[[0,11]])})),function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(t){_i(o,r,i,a,s,"next",t)}function s(t){_i(o,r,i,a,s,"throw",t)}a(void 0)}))})()),this}},{key:"updateViewCache",value:function(t){if(this.cells){this.cellsViewCache=[];var e,n=vi(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;+r.x+this.resolution<t.xMin||+r.x-this.resolution>t.xMax||+r.y+this.resolution<t.yMin||+r.y-this.resolution>t.yMax||this.cellsViewCache.push(r)}}catch(t){n.e(t)}finally{n.f()}}}}],r&&wi(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(On);function Ti(t){return Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ti(t)}function Ni(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Si(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Si(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Si(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Ii(){Ii=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function f(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=e&&e.prototype instanceof v?e:v,a=Object.create(o.prototype),s=new L(r||[]);return i(a,"_invoke",{value:T(t,n,s)}),a}function l(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=c;var h="suspendedStart",p="suspendedYield",d="executing",y="completed",m={};function v(){}function g(){}function _(){}var w={};f(w,a,(function(){return this}));var b=Object.getPrototypeOf,x=b&&b(b(O([])));x&&x!==n&&r.call(x,a)&&(w=x);var E=_.prototype=v.prototype=Object.create(w);function A(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(i,o,a,s){var u=l(t[i],t,o);if("throw"!==u.type){var f=u.arg,c=f.value;return c&&"object"==Ti(c)&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(c).then((function(t){f.value=t,a(f)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function T(e,n,r){var i=h;return function(o,a){if(i===d)throw Error("Generator is already running");if(i===y){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=N(s,r);if(u){if(u===m)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=d;var f=l(e,n,r);if("normal"===f.type){if(i=r.done?y:p,f.arg===m)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(i=y,r.method="throw",r.arg=f.arg)}}}function N(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,N(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;var o=l(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,m;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function O(e){if(e||""===e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(Ti(e)+" is not iterable")}return g.prototype=_,i(E,"constructor",{value:_,configurable:!0}),i(_,"constructor",{value:g,configurable:!0}),g.displayName=f(_,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,f(t,u,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},A(M.prototype),f(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new M(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},A(E),f(E,u,"Generator"),f(E,a,(function(){return this})),f(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=O,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),f=r.call(a,"finallyLoc");if(u&&f){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!f)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),I(n),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:O(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}function Li(t,e,n,r,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void n(t)}s.done?e(u):Promise.resolve(u).then(r,i)}function Oi(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function a(t){Li(o,r,i,a,s,"next",t)}function s(t){Li(o,r,i,a,s,"throw",t)}a(void 0)}))}}function Pi(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,ki(r.key),r)}}function ki(t){var e=function(t){if("object"!=Ti(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Ti(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Ti(e)?e:e+""}function Ri(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(Ri=function(){return!!t})()}function Ci(t){return Ci=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ci(t)}function Di(t,e){return Di=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Di(t,e)}var Bi=function(t){function e(t,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=function(t,e,n){return e=Ci(e),function(t,e){if(e&&("object"==Ti(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ri()?Reflect.construct(e,n||[],Ci(t).constructor):e.apply(t,n))}(this,e,[t,n,0,i])).extension=i.extension||"parquet",r.info=void 0,r.infoLoadingStatus="notLoaded",r.names=void 0,r.types=void 0,r.cache={},r.loadInfo(),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Di(t,e)}(e,t),n=e,r=[{key:"loadInfo",value:function(){var t=this;return this.info||"notLoaded"!==this.infoLoadingStatus?"loaded"!==this.infoLoadingStatus&&"failed"!==this.infoLoadingStatus||this.map.redraw():Oi(Ii().mark((function e(){var n;return Ii().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,kn(t.url+"info.json");case 3:n=e.sent,t.info=n,t.resolution=n.resolutionGeo,t.infoLoadingStatus="loaded",t.map.redraw(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),t.infoLoadingStatus="failed";case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))(),this}},{key:"getTilingEnvelope",value:function(t){if(this.info){var e=this.info.originPoint,n=this.info.resolutionGeo,r=this.info.tileSizeCell;return{xMin:Math.floor((t.xMin-e.x)/(n*r)),xMax:Math.floor((t.xMax-e.x)/(n*r)),yMin:Math.floor((t.yMin-e.y)/(n*r)),yMax:Math.floor((t.yMax-e.y)/(n*r))}}this.loadInfo()}},{key:"getData",value:function(t){var e=this;if(!this.info)return this;var n=this.getTilingEnvelope(t);if(!n)return this;for(var r=this.info.tilingBounds,i=function(t){for(var i=function(n){if(e.cache[t]||(e.cache[t]={}),e.cache[t][n])return 1;e.cache[t][n]="loading",Oi(Ii().mark((function r(){var i,o,a,s,u,f,c,l,h,p,d,y;return Ii().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,o=e.url+t+"/"+n+"."+e.extension,r.next=4,fetch(o);case 4:return a=r.sent,r.next=7,a.arrayBuffer();case 7:return s=r.sent,r.next=10,di({file:s,onComplete:function(t){if(!e.names&&!e.types){var n=Dr(s).schema;e.names=[],e.types=[];for(var r=1;r<n.length;r++){e.names.push(n[r].name);var o=n[r].type+"",a=o.includes("INT")||"FLOAT"==o||"DOUBLE"==o?"number":"string";e.types.push(a)}}if(t=t.map((function(t){for(var n={},r=0;r<e.names.length;r++){var i=t[r];null!=i&&null!=i?("number"==e.types[r]?i=Number(t[r]):i+="",n[e.names[r]]=i):n[e.names[r]]=i}return n})),e.preprocess){i=[];var u,f=Ni(t);try{for(f.s();!(u=f.n()).done;){var c=u.value;0!=e.preprocess(c)&&i.push(c)}}catch(t){f.e(t)}finally{f.f()}}else i=t}});case 10:r.next=16;break;case 12:return r.prev=12,r.t0=r.catch(0),e.cache[t][n]="failed",r.abrupt("return");case 16:if(e.info){r.next=19;break}return console.error("Tile info inknown"),r.abrupt("return");case 19:u=zi(i,t,n,e.info),e.cache[t][n]=u,e.map.redraw(),f=!1,c=e.map.getZoom(),l=Ni(e.map.layers),r.prev=25,l.s();case 27:if((h=l.n()).done){r.next=39;break}if(!(p=h.value).visible||p.visible(c)){r.next=31;break}return r.abrupt("continue",37);case 31:if(p.getDataset){r.next=33;break}return r.abrupt("continue",37);case 33:if(p.getDataset(c)==e){r.next=35;break}return r.abrupt("continue",37);case 35:return f=!0,r.abrupt("break",39);case 37:r.next=27;break;case 39:r.next=44;break;case 41:r.prev=41,r.t1=r.catch(25),l.e(r.t1);case 44:return r.prev=44,l.f(),r.finish(44);case 47:if(f){r.next=49;break}return r.abrupt("return");case 49:if(d=e.map.updateExtentGeo(),y=u.extGeo,!(d.xMax<=y.xMin)){r.next=53;break}return r.abrupt("return");case 53:if(!(d.xMin>=y.xMax)){r.next=55;break}return r.abrupt("return");case 55:if(!(d.yMax<=y.yMin)){r.next=57;break}return r.abrupt("return");case 57:if(!(d.yMin>=y.yMax)){r.next=59;break}return r.abrupt("return");case 59:e.map.redraw();case 60:case"end":return r.stop()}}),r,null,[[0,12],[25,41,44,47]])})))()},o=Math.max(n.yMin,r.yMin);o<=Math.min(n.yMax,r.yMax);o++)i(o)},o=Math.max(n.xMin,r.xMin);o<=Math.min(n.xMax,r.xMax);o++)i(o);return this}},{key:"updateViewCache",value:function(t){if(this.cellsViewCache=[],this.info){var e=this.getTilingEnvelope(t);if(e)for(var n=this.info.tilingBounds,r=Math.max(e.xMin,n.xMin);r<=Math.min(e.xMax,n.xMax);r++)if(this.cache[r])for(var i=Math.max(e.yMin,n.yMin);i<=Math.min(e.yMax,n.yMax);i++){var o=this.cache[r][i];if(o&&"string"!=typeof o){var a,s=Ni(o.cells);try{for(s.s();!(a=s.n()).done;){var u=a.value;+u.x+this.resolution<t.xMin||+u.x-this.resolution>t.xMax||+u.y+this.resolution<t.yMin||+u.y-this.resolution>t.yMax||this.cellsViewCache.push(u)}}catch(t){s.e(t)}finally{s.f()}}}}}}],r&&Pi(n.prototype,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r}(On);function zi(t,e,n,r){var i={};i.cells=t,i.x=e,i.y=n;var o=r.resolutionGeo,a=r.tileSizeCell;i.extGeo={xMin:r.originPoint.x+o*a*i.x,xMax:r.originPoint.x+o*a*(i.x+1),yMin:r.originPoint.y+o*a*i.y,yMax:r.originPoint.y+o*a*(i.y+1)};var s,u=Ni(i.cells);try{for(u.s();!(s=u.n()).done;){var f=s.value;f.x=i.extGeo.xMin+f.x*o,f.y=i.extGeo.yMin+f.y*o}}catch(t){u.e(t)}finally{u.f()}return i}return e})()));